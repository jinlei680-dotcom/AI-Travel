{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/lujinlei/Documents/code/AI-Travel-Homework/AI-Travel/web/src/lib/itinerarySchema.ts"],"sourcesContent":["import { z } from \"zod\";\n\n// ---------- Input Spec (camelCase or snake_case) ----------\nexport const PlanSpecInputSchema = z.object({\n  destination: z.string().min(1, \"destination required\"),\n  start_date: z.string().optional(),\n  end_date: z.string().optional(),\n  startDate: z.string().optional(),\n  endDate: z.string().optional(),\n  preferences: z\n    .object({\n      pace: z.enum([\"relaxed\", \"standard\", \"tight\"]).optional(),\n      interests: z.array(z.string()).optional(),\n      budgetTotal: z.number().optional(),\n      peopleCount: z.number().int().positive().optional(),\n    })\n    .optional(),\n});\n\nexport type PlanSpecInput = z.infer<typeof PlanSpecInputSchema>;\n\nexport function normalizeSpec(spec: PlanSpecInput) {\n  const start_date = (spec.start_date || spec.startDate || \"\").slice(0, 10);\n  const end_date = (spec.end_date || spec.endDate || \"\").slice(0, 10);\n  return {\n    destination: spec.destination,\n    start_date,\n    end_date,\n    preferences: spec.preferences || {},\n  } as {\n    destination: string;\n    start_date: string;\n    end_date: string;\n    preferences?: { pace?: \"relaxed\" | \"standard\" | \"tight\"; interests?: string[]; budgetTotal?: number; peopleCount?: number };\n  };\n}\n\n// ---------- Utilities ----------\nexport function fmtDate(d: Date) {\n  const y = d.getFullYear();\n  const m = String(d.getMonth() + 1).padStart(2, \"0\");\n  const day = String(d.getDate()).padStart(2, \"0\");\n  return `${y}-${m}-${day}`;\n}\n\nexport function daysBetweenInclusive(start: Date, end: Date) {\n  const out: Date[] = [];\n  const cur = new Date(start);\n  while (cur <= end) {\n    out.push(new Date(cur));\n    cur.setDate(cur.getDate() + 1);\n  }\n  return out;\n}\n\nexport function defaultSlots(pace: string | undefined) {\n  const p = pace || \"standard\";\n  if (p === \"relaxed\") return [\"上午\", \"下午\"];\n  if (p === \"tight\") return [\"早间\", \"上午\", \"下午\", \"傍晚\", \"夜间\"];\n  return [\"上午\", \"下午\", \"夜间\"];\n}\n\nexport function defaultSlotTime(idx: number) {\n  const t = [\"09:00\", \"13:30\", \"18:00\", \"20:00\", \"22:00\"];\n  return t[idx] || \"09:00\";\n}\n\n// ---------- Day/Item Schemas ----------\nexport const PlanItemSchema = z.object({\n  id: z.string().optional(),\n  time: z.string().optional(),\n  title: z.string(),\n  note: z.string().optional(),\n  // richer fields for frontend display\n  place: z\n    .object({\n      name: z.string(),\n      location: z.object({ lat: z.number(), lng: z.number() }).optional(),\n      address: z.string().optional(),\n      poiId: z.string().optional(),\n      category: z.string().optional(),\n    })\n    .optional(),\n  durationEstimate: z.number().optional(),\n  costEstimate: z.number().optional(),\n});\nexport type PlanItem = z.infer<typeof PlanItemSchema>;\n\nexport const TransportSchema = z.object({\n  mode: z.string(),\n  steps: z.array(z.string()).optional(),\n  timeEstimate: z.number().optional(),\n  priceEstimate: z.number().optional(),\n});\nexport type Transport = z.infer<typeof TransportSchema>;\n\nconst LocationSchema = z.object({ lat: z.number(), lng: z.number() });\n\nexport const DiningItemSchema = z.object({\n  name: z.string(),\n  cuisine: z.string().optional(),\n  priceRange: z.tuple([z.number(), z.number()]).optional(),\n  rating: z.number().optional(),\n  distance: z.number().optional(),\n  booking: z.boolean().optional(),\n  location: LocationSchema.optional(),\n  address: z.string().optional(),\n  phone: z.string().optional(),\n  opening_hours: z.string().optional(),\n  website: z.string().optional(),\n  tags: z.array(z.string()).optional(),\n});\nexport type DiningItem = z.infer<typeof DiningItemSchema>;\n\nexport const LodgingItemSchema = z.object({\n  name: z.string(),\n  area: z.string().optional(),\n  price: z.number().optional(),\n  rating: z.number().optional(),\n  distanceToCore: z.number().optional(),\n  amenities: z.array(z.string()).optional(),\n  location: LocationSchema.optional(),\n  address: z.string().optional(),\n  phone: z.string().optional(),\n  opening_hours: z.string().optional(),\n  website: z.string().optional(),\n  tags: z.array(z.string()).optional(),\n  stars: z.number().optional(),\n  checkin_time: z.string().optional(),\n  checkout_time: z.string().optional(),\n  room_types: z.array(z.string()).optional(),\n});\nexport type LodgingItem = z.infer<typeof LodgingItemSchema>;\n\nexport const AttractionItemSchema = z.object({\n  name: z.string(),\n  ticket: z.union([z.number(), z.string()]).optional(),\n  best_time: z.string().optional(),\n  tips: z.string().optional(),\n  photo_spots: z.array(z.string()).optional(),\n  address: z.string().optional(),\n  opening_hours: z.string().optional(),\n  website: z.string().optional(),\n  tags: z.array(z.string()).optional(),\n  location: LocationSchema.optional(),\n  durationEstimate: z.number().optional(),\n});\nexport type AttractionItem = z.infer<typeof AttractionItemSchema>;\n\nexport const RoutePointSchema = z.object({ lat: z.number(), lng: z.number() });\n\nexport const PlanDaySchema = z.object({\n  date: z.string(),\n  items: z.array(PlanItemSchema),\n  routePath: z.array(RoutePointSchema).optional(),\n  transport: TransportSchema.optional(),\n  dining: z.array(DiningItemSchema).optional(),\n  lodging: z.array(LodgingItemSchema).optional(),\n  attractions: z.array(AttractionItemSchema).optional(),\n  markers: z\n    .array(\n      z.object({\n        location: LocationSchema,\n        title: z.string().optional(),\n        category: z.string().optional(),\n        id: z.string().optional(),\n        dayIndex: z.number().optional(),\n        poiId: z.string().optional(),\n      })\n    )\n    .optional(),\n});\nexport type PlanDay = z.infer<typeof PlanDaySchema>;\n\nexport const MarkerSchema = z.object({\n  position: z.tuple([z.number(), z.number()]),\n  title: z.string().optional(),\n});\n\nexport const PlanDataSchema = z.object({\n  id: z.string(),\n  destination: z.string(),\n  start_date: z.string(),\n  end_date: z.string(),\n  days: z.array(PlanDaySchema),\n  markers: z.array(MarkerSchema).optional(),\n  source: z.enum([\"llm\", \"fallback\"]).optional(),\n});\n\n// ---------- Repair ----------\nexport function repairDays(args: {\n  rawDays: any[];\n  allDates: string[];\n  destination: string;\n  pace?: string;\n}): PlanDay[] {\n  const { rawDays, allDates, destination, pace } = args;\n  const slots = defaultSlots(pace);\n  const byDate: Record<string, PlanDay> = {};\n\n  for (const rd of rawDays || []) {\n    const date = String(rd?.date || \"\");\n    if (!date) continue;\n    const itemsArr = Array.isArray(rd.items) ? rd.items : [];\n    const items: PlanItem[] = itemsArr.map((it: any, idx: number) => ({\n      id: `${date}-${idx}`,\n      time: String(it?.time || \"\"),\n      title: String(it?.title || \"待定\"),\n      note: it?.note ? String(it.note) : undefined,\n    }));\n    const day: PlanDay = {\n      date,\n      items,\n      routePath: Array.isArray(rd.routePath)\n        ? rd.routePath\n            .map((p: any) => ({ lat: Number(p?.lat), lng: Number(p?.lng) }))\n            .filter((p: any) => Number.isFinite(p.lat) && Number.isFinite(p.lng))\n        : undefined,\n      transport: rd.transport && typeof rd.transport === \"object\" ? {\n        mode: String(rd.transport.mode || \"transit\"),\n        steps: Array.isArray(rd.transport.steps) ? rd.transport.steps.map((s: any) => String(s)) : undefined,\n        timeEstimate: rd.transport.timeEstimate ? Number(rd.transport.timeEstimate) : undefined,\n        priceEstimate: rd.transport.priceEstimate ? Number(rd.transport.priceEstimate) : undefined,\n      } : undefined,\n      dining: Array.isArray(rd.dining)\n        ? rd.dining.map((d: any) => ({\n            name: String(d?.name || \"当地餐馆\"),\n            cuisine: d?.cuisine ? String(d.cuisine) : undefined,\n            priceRange: Array.isArray(d?.priceRange) && d.priceRange.length === 2 ? [Number(d.priceRange[0]), Number(d.priceRange[1])] : undefined,\n            rating: d?.rating ? Number(d.rating) : undefined,\n            distance: d?.distance ? Number(d.distance) : undefined,\n            booking: typeof d?.booking === \"boolean\" ? d.booking : undefined,\n            location: d?.location && typeof d.location === \"object\" ? { lat: Number(d.location.lat), lng: Number(d.location.lng) } : undefined,\n          }))\n        : undefined,\n      lodging: Array.isArray(rd.lodging)\n        ? rd.lodging.map((h: any) => ({\n            name: String(h?.name || \"酒店\"),\n            area: h?.area ? String(h.area) : undefined,\n            price: h?.price ? Number(h.price) : undefined,\n            rating: h?.rating ? Number(h.rating) : undefined,\n            distanceToCore: h?.distanceToCore ? Number(h.distanceToCore) : undefined,\n            amenities: Array.isArray(h?.amenities) ? h.amenities.map((a: any) => String(a)) : undefined,\n            location: h?.location && typeof h.location === \"object\" ? { lat: Number(h.location.lat), lng: Number(h.location.lng) } : undefined,\n          }))\n        : undefined,\n      attractions: Array.isArray(rd.attractions)\n        ? rd.attractions.map((a: any) => ({\n            name: String(a?.name || \"景点\"),\n            ticket: typeof a?.ticket === \"number\" ? a.ticket : a?.ticket ? String(a.ticket) : undefined,\n            best_time: a?.best_time ? String(a.best_time) : undefined,\n            tips: a?.tips ? String(a.tips) : undefined,\n            photo_spots: Array.isArray(a?.photo_spots) ? a.photo_spots.map((p: any) => String(p)) : undefined,\n          }))\n        : undefined,\n    };\n    byDate[date] = day;\n  }\n\n  const out: PlanDay[] = [];\n  for (let i = 0; i < allDates.length; i++) {\n    const date = allDates[i];\n    const existing = byDate[date];\n    if (existing) {\n      out.push(existing);\n    } else {\n      const items: PlanItem[] = (slots || []).map((_, idx) => ({\n        id: `${date}-${idx}`,\n        time: defaultSlotTime(idx),\n        title: `${destination} 行程建议`,\n      }));\n      out.push({ date, items });\n    }\n  }\n  return out;\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 355, "column": 0}, "map": {"version":3,"sources":["file:///Users/lujinlei/Documents/code/AI-Travel-Homework/AI-Travel/web/src/app/api/plan/create/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { z } from \"zod\";\nimport {\n  PlanSpecInputSchema,\n  normalizeSpec,\n  PlanItem,\n  PlanDay,\n  PlanDataSchema,\n  fmtDate,\n  daysBetweenInclusive,\n  defaultSlots,\n  defaultSlotTime,\n  repairDays,\n} from \"@/lib/itinerarySchema\";\n\nexport const runtime = \"nodejs\";\n\nconst PlanSpecSchema = PlanSpecInputSchema;\n\ntype Marker = { position: [number, number]; title?: string };\n\nfunction fmtDateLocal(d: Date) {\n  return fmtDate(d);\n}\n\nasync function findCityMarkers(city: string): Promise<Marker[]> {\n  const key = process.env.AMAP_WEBSERVICE_KEY;\n  if (!key) {\n    return [\n      { position: [116.397428, 39.90923], title: `${city} 地标A` },\n      { position: [116.384, 39.923], title: `${city} 地标B` },\n    ];\n  }\n  const params = new URLSearchParams({\n    key,\n    keywords: \"景点\",\n    city,\n    citylimit: \"true\",\n    offset: \"5\",\n  });\n  const url = `https://restapi.amap.com/v3/place/text?${params.toString()}`;\n  try {\n    const resp = await fetch(url);\n    const data = await resp.json();\n    const pois: any[] = data?.pois || [];\n    return pois.slice(0, 5).map((p) => {\n      const [lngStr, latStr] = String(p.location || \"\").split(\",\");\n      const lng = Number(lngStr);\n      const lat = Number(latStr);\n      return { position: [lng, lat], title: p.name } as Marker;\n    });\n  } catch {\n    return [\n      { position: [116.397428, 39.90923], title: `${city} 地标A` },\n      { position: [116.384, 39.923], title: `${city} 地标B` },\n    ];\n  }\n}\n\nasync function parseJsonRequest(req: Request): Promise<any> {\n  try {\n    return await req.json();\n  } catch {\n    try {\n      const text = await req.text();\n      return JSON.parse(text);\n    } catch {\n      return {};\n    }\n  }\n}\n\n// --- Budget estimation helpers (server-side strong check) ---\nfunction avgPrice(range?: [number, number]): number {\n  if (!range || range.length !== 2) return 0;\n  const a = Number(range[0]);\n  const b = Number(range[1]);\n  return Number.isFinite(a) && Number.isFinite(b) ? (a + b) / 2 : 0;\n}\n\nfunction ticketToNumber(t?: number | string): number {\n  if (t == null) return 0;\n  if (typeof t === \"number\" && Number.isFinite(t)) return t;\n  const n = Number(t);\n  return Number.isFinite(n) ? n : 0;\n}\n\nfunction estimateBudgetTotals(days: PlanDay[], peopleCount: number = 1): {\n  byDay: { date: string; transport: number; dining: number; lodging: number; tickets: number; items: number; total: number }[];\n  totals: { transport: number; dining: number; lodging: number; tickets: number; items: number; grand: number };\n} {\n  const byDay: { date: string; transport: number; dining: number; lodging: number; tickets: number; items: number; total: number }[] = [];\n  let transport = 0, dining = 0, lodging = 0, tickets = 0, items = 0;\n  for (const d of days || []) {\n    const t = Number(d.transport?.priceEstimate) || 0;\n    const dinePerCapita = (d.dining || []).reduce((s, it) => s + avgPrice(it.priceRange as any), 0);\n    const dine = dinePerCapita * Math.max(1, peopleCount);\n    const lodge = (d.lodging || []).reduce((s, it) => s + (Number((it as any).price) || 0), 0);\n    const ticketsPerCapita = (d.attractions || []).reduce((s, it) => s + ticketToNumber((it as any).ticket), 0);\n    const tick = ticketsPerCapita * Math.max(1, peopleCount);\n    const its = (d.items || []).reduce((s, it) => s + (Number((it as any).costEstimate) || 0), 0);\n    const total = t + dine + lodge + tick + its;\n    byDay.push({ date: d.date, transport: t, dining: dine, lodging: lodge, tickets: tick, items: its, total });\n    transport += t; dining += dine; lodging += lodge; tickets += tick; items += its;\n  }\n  const grand = transport + dining + lodging + tickets + items;\n  return { byDay, totals: { transport, dining, lodging, tickets, items, grand } };\n}\n\nasync function refinePlanToBudget(params: {\n  originalDays: PlanDay[];\n  destination: string;\n  start_date: string;\n  end_date: string;\n  budgetTotal: number;\n  peopleCount?: number;\n}): Promise<PlanDay[] | null> {\n  const { originalDays, destination, start_date, end_date, budgetTotal, peopleCount = 1 } = params;\n  const apiKey = process.env.DOUBAO_API_KEY;\n  const model = process.env.DOUBAO_MODEL;\n  const base = process.env.DOUBAO_API_BASE || \"\";\n  if (!apiKey || !model || !base) return null;\n  const url = base.replace(/\\/$/, \"\") + \"/chat/completions\";\n\n  // Keep the same schema as generation, but focus on budget adjustment\n  const schemaSnippet: any = {\n    type: \"object\",\n    properties: {\n      id: { type: \"string\" },\n      destination: { type: \"string\" },\n      start_date: { type: \"string\" },\n      end_date: { type: \"string\" },\n      days: { type: \"array\", items: { type: \"object\", properties: { date: { type: \"string\" }, items: { type: \"array\" }, routePath: { type: \"array\" }, transport: { type: \"object\" }, dining: { type: \"array\" }, lodging: { type: \"array\" }, attractions: { type: \"array\" } }, required: [\"date\", \"items\"], additionalProperties: false } },\n      markers: { type: \"array\" },\n    },\n    required: [\"destination\", \"start_date\", \"end_date\", \"days\"],\n    additionalProperties: false,\n  };\n\n  const sys = `只输出严格 JSON（不允许任何非JSON内容）。你将收到一个现有行程的 JSON；在不改变字段结构的前提下，优先通过更换住宿/餐饮/交通/门票等选项调整价格，使“估算总费用”与“预算 ¥${Math.round(\n    budgetTotal\n  )}”的差额不超过 ¥1000。必须覆盖从 ${start_date} 到 ${end_date} 的每一天，并保持地点在“${destination}”辖区内。每天必须返回三顿餐饮（早餐/午餐/晚餐），并在预算计算时将餐饮 priceRange 与景点 ticket 按人数 ${Math.max(\n    1,\n    peopleCount\n  )} 倍计入总费用（人均×人数）。名称需为具体店名/景点名。所有价格字段请尽量给出可计算的数值（items.costEstimate、transport.priceEstimate、dining.priceRange、lodging.price、attractions.ticket）。最终输出为完整闭合 JSON，遵循 Schema：${JSON.stringify(\n    schemaSnippet\n  )}。`;\n\n  const current = {\n    destination,\n    start_date,\n    end_date,\n    days: originalDays,\n  };\n\n  const baseBody: any = {\n    model,\n    messages: [\n      { role: \"system\", content: sys },\n      { role: \"user\", content: JSON.stringify({ budgetTotal, peopleCount, currentPlan: current }) },\n    ],\n    temperature: Number(process.env.DOUBAO_TEMPERATURE ?? 0.2),\n    max_tokens: Math.min(Number(process.env.DOUBAO_MAX_TOKENS ?? 3500), 2500),\n    response_format: { type: \"json_object\" },\n  };\n\n  try {\n    const resp = await fetch(url, { method: \"POST\", headers: { \"Content-Type\": \"application/json\", Authorization: `Bearer ${apiKey}` }, body: JSON.stringify(baseBody) });\n    const data = await resp.json().catch(() => null as any);\n    if (!resp.ok || !data) return null;\n    const content = data?.choices?.[0]?.message?.content ?? \"\";\n    let obj: any = null;\n    if (typeof content === \"string\") {\n      try { obj = JSON.parse(content); } catch {\n        let s = content; s = s.replace(/```[a-zA-Z]*\\n?/g, \"\").replace(/```/g, \"\");\n        const m = s.match(/\\{[\\s\\S]*\\}/); if (m) { let candidate = m[0]; candidate = candidate.replace(/,\\s*([\\}\\]])/g, \"$1\"); try { obj = JSON.parse(candidate); } catch {} }\n      }\n    } else { obj = content; }\n    const rawDays = Array.isArray(obj?.days) ? obj.days : [];\n    if (!rawDays.length) return null;\n    const days = rawDays.map((d: any, di: number) => ({\n      date: String(d.date || \"\").slice(0, 10) || (originalDays[di]?.date || start_date),\n      items: (Array.isArray(d.items) ? d.items : []).map((it: any, idx: number) => ({\n        id: `${String(d.date || start_date)}-${idx}`,\n        time: String(it.time || \"\"),\n        title: String(it.title || \"待定\"),\n        note: it.note ? String(it.note) : undefined,\n        place: it.place && typeof it.place === \"object\" ? {\n          name: String(it.place.name || \"\"),\n          location: it.place.location && typeof it.place.location === \"object\" ? { lat: Number(it.place.location.lat), lng: Number(it.place.location.lng) } : undefined,\n          address: it.place.address ? String(it.place.address) : undefined,\n          poiId: it.place.poiId ? String(it.place.poiId) : undefined,\n          category: it.place.category ? String(it.place.category) : undefined,\n        } : undefined,\n        durationEstimate: it.durationEstimate ? Number(it.durationEstimate) : undefined,\n        costEstimate: it.costEstimate ? Number(it.costEstimate) : undefined,\n      })),\n      routePath: Array.isArray(d.routePath) ? d.routePath.map((p: any) => ({ lat: Number(p?.lat), lng: Number(p?.lng) })).filter((p: any) => Number.isFinite(p.lat) && Number.isFinite(p.lng)) : undefined,\n      transport: d.transport && typeof d.transport === \"object\" ? {\n        mode: String(d.transport.mode || \"transit\"),\n        steps: Array.isArray(d.transport.steps) ? d.transport.steps.map((s: any) => String(s)) : undefined,\n        timeEstimate: d.transport.timeEstimate ? Number(d.transport.timeEstimate) : undefined,\n        priceEstimate: d.transport.priceEstimate ? Number(d.transport.priceEstimate) : undefined,\n      } : undefined,\n      dining: Array.isArray(d.dining) ? d.dining.map((r: any) => ({\n        name: String(r?.name || \"餐馆\"),\n        cuisine: r?.cuisine ? String(r.cuisine) : undefined,\n        priceRange: Array.isArray(r?.priceRange) && r.priceRange.length === 2 ? [Number(r.priceRange[0]), Number(r.priceRange[1])] : undefined,\n        rating: r?.rating ? Number(r.rating) : undefined,\n        distance: r?.distance ? Number(r.distance) : undefined,\n        booking: typeof r?.booking === \"boolean\" ? r.booking : undefined,\n        location: r?.location && typeof r.location === \"object\" ? { lat: Number(r.location.lat), lng: Number(r.location.lng) } : undefined,\n        address: r?.address ? String(r.address) : undefined,\n        phone: r?.phone ? String(r.phone) : undefined,\n        opening_hours: r?.opening_hours ? String(r.opening_hours) : undefined,\n        website: r?.website ? String(r.website) : undefined,\n        tags: Array.isArray(r?.tags) ? r.tags.map((t: any) => String(t)) : undefined,\n      })) : undefined,\n      lodging: Array.isArray(d.lodging) ? d.lodging.map((h: any) => ({\n        name: String(h?.name || \"酒店\"),\n        area: h?.area ? String(h.area) : undefined,\n        price: h?.price ? Number(h.price) : undefined,\n        rating: h?.rating ? Number(h.rating) : undefined,\n        distanceToCore: h?.distanceToCore ? Number(h.distanceToCore) : undefined,\n        amenities: Array.isArray(h?.amenities) ? h.amenities.map((a: any) => String(a)) : undefined,\n        location: h?.location && typeof h.location === \"object\" ? { lat: Number(h.location.lat), lng: Number(h.location.lng) } : undefined,\n        address: h?.address ? String(h.address) : undefined,\n        phone: h?.phone ? String(h.phone) : undefined,\n        opening_hours: h?.opening_hours ? String(h.opening_hours) : undefined,\n        website: h?.website ? String(h.website) : undefined,\n        tags: Array.isArray(h?.tags) ? h.tags.map((t: any) => String(t)) : undefined,\n        stars: h?.stars ? Number(h.stars) : undefined,\n        checkin_time: h?.checkin_time ? String(h.checkin_time) : undefined,\n        checkout_time: h?.checkout_time ? String(h.checkout_time) : undefined,\n        room_types: Array.isArray(h?.room_types) ? h.room_types.map((rt: any) => String(rt)) : undefined,\n      })) : undefined,\n      attractions: Array.isArray(d.attractions) ? d.attractions.map((a: any) => ({\n        name: String(a?.name || \"景点\"),\n        ticket: typeof a?.ticket === \"number\" ? a.ticket : a?.ticket ? String(a.ticket) : undefined,\n        best_time: a?.best_time ? String(a.best_time) : undefined,\n        tips: a?.tips ? String(a.tips) : undefined,\n        photo_spots: Array.isArray(a?.photo_spots) ? a.photo_spots.map((p: any) => String(p)) : undefined,\n        address: a?.address ? String(a.address) : undefined,\n        opening_hours: a?.opening_hours ? String(a.opening_hours) : undefined,\n        website: a?.website ? String(a.website) : undefined,\n        tags: Array.isArray(a?.tags) ? a.tags.map((t: any) => String(t)) : undefined,\n        location: a?.location && typeof a.location === \"object\" ? { lat: Number(a.location.lat), lng: Number(a.location.lng) } : undefined,\n        durationEstimate: a?.durationEstimate ? Number(a.durationEstimate) : undefined,\n      })) : undefined,\n    }));\n    return days;\n  } catch {\n    return null;\n  }\n}\n\nexport async function POST(req: Request) {\n  const raw = await parseJsonRequest(req);\n  // Fallback: read from query string if body is empty or missing fields\n  let merged = raw;\n  try {\n    const u = new URL(req.url);\n    const qs: Record<string, string> = {};\n    for (const [k, v] of u.searchParams.entries()) qs[k] = v;\n    merged = { ...qs, ...raw };\n    // If preferences comes from querystring, it will be a JSON string; try to parse it.\n    if (typeof (merged as any).preferences === \"string\") {\n      try {\n        (merged as any).preferences = JSON.parse((merged as any).preferences);\n      } catch {}\n    }\n  } catch {}\n  const parsed = PlanSpecSchema.safeParse(merged);\n  if (!parsed.success) {\n    return NextResponse.json({ error: \"invalid_spec\", issues: parsed.error.issues }, { status: 400 });\n  }\n  const { destination, start_date, end_date, preferences } = normalizeSpec(parsed.data);\n\n  const start = new Date(start_date);\n  const end = new Date(end_date);\n  const allDays = daysBetweenInclusive(start, end);\n\n  const pace = preferences?.pace || \"standard\";\n  const slots = defaultSlots(pace);\n  const interests = (preferences?.interests || []).slice(0, 6);\n  const budgetTotal = typeof preferences?.budgetTotal === \"number\" ? preferences!.budgetTotal : undefined;\n  const peopleCount = typeof preferences?.peopleCount === \"number\" && preferences!.peopleCount > 0 ? preferences!.peopleCount : 1;\n\n  // Prepare candidate POIs for context\n  const candidateMarkers = await findCityMarkers(destination);\n  const candidatePOIs = candidateMarkers.map((m) => ({ name: m.title || \"地标\", lng: m.position[0], lat: m.position[1] }));\n\n  // 生成完整计划（包含 days 与可选 markers），若不可用则返回 null\n  async function generatePlanWithDoubao(): Promise<{ days: PlanDay[]; markers?: Marker[] } | null> {\n    const apiKey = process.env.DOUBAO_API_KEY;\n    const model = process.env.DOUBAO_MODEL;\n    const base = process.env.DOUBAO_API_BASE || \"\";\n    // 放宽提供方限制：允许任意 OpenAI 兼容端点（只要提供 base/model/key 即可）\n    if (!apiKey || !model || !base) return null;\n    const url = base.replace(/\\/$/, \"\") + \"/chat/completions\";\n    const schemaSnippet = {\n      type: \"object\",\n      properties: {\n        id: { type: \"string\" },\n        destination: { type: \"string\" },\n        start_date: { type: \"string\" },\n        end_date: { type: \"string\" },\n        days: {\n          type: \"array\",\n          items: {\n            type: \"object\",\n            properties: {\n              date: { type: \"string\" },\n              items: {\n                type: \"array\",\n                items: {\n                  type: \"object\",\n                  properties: {\n                    time: { type: \"string\" },\n                    title: { type: \"string\" },\n                    note: { type: \"string\" },\n                    place: {\n                      type: \"object\",\n                      properties: {\n                        name: { type: \"string\" },\n                        location: { type: \"object\", properties: { lat: { type: \"number\" }, lng: { type: \"number\" } }, additionalProperties: false },\n                        address: { type: \"string\" },\n                        poiId: { type: \"string\" },\n                        category: { type: \"string\" },\n                      },\n                      required: [\"name\"],\n                      additionalProperties: false,\n                    },\n                    durationEstimate: { type: \"number\" },\n                    costEstimate: { type: \"number\" },\n                  },\n                  required: [\"time\", \"title\", \"place\", \"costEstimate\"],\n                  additionalProperties: false,\n                },\n              },\n              routePath: {\n                type: \"array\",\n                items: { type: \"object\", properties: { lat: { type: \"number\" }, lng: { type: \"number\" } }, required: [\"lat\", \"lng\"], additionalProperties: false },\n              },\n              transport: {\n                type: \"object\",\n                properties: {\n                  mode: { type: \"string\" },\n                  steps: { type: \"array\", items: { type: \"string\" } },\n                  timeEstimate: { type: \"number\" },\n                  priceEstimate: { type: \"number\" },\n                },\n                required: [\"mode\", \"timeEstimate\", \"priceEstimate\"],\n                additionalProperties: false,\n              },\n              dining: {\n                type: \"array\",\n                items: {\n                  type: \"object\",\n                  properties: {\n                    name: { type: \"string\" },\n                    cuisine: { type: \"string\" },\n                    priceRange: { type: \"array\", items: { type: \"number\" }, minItems: 2, maxItems: 2 },\n                    rating: { type: \"number\" },\n                    distance: { type: \"number\" },\n                    booking: { type: \"boolean\" },\n                    location: { type: \"object\", properties: { lat: { type: \"number\" }, lng: { type: \"number\" } }, additionalProperties: false },\n                    address: { type: \"string\" },\n                    phone: { type: \"string\" },\n                    opening_hours: { type: \"string\" },\n                    website: { type: \"string\" },\n                    tags: { type: \"array\", items: { type: \"string\" } },\n                  },\n                  required: [\"name\", \"priceRange\"],\n                  additionalProperties: false,\n                },\n              },\n              lodging: {\n                type: \"array\",\n                items: {\n                  type: \"object\",\n                  properties: {\n                    name: { type: \"string\" },\n                    area: { type: \"string\" },\n                    price: { type: \"number\" },\n                    rating: { type: \"number\" },\n                    distanceToCore: { type: \"number\" },\n                    amenities: { type: \"array\", items: { type: \"string\" } },\n                    location: { type: \"object\", properties: { lat: { type: \"number\" }, lng: { type: \"number\" } }, additionalProperties: false },\n                    address: { type: \"string\" },\n                    phone: { type: \"string\" },\n                    opening_hours: { type: \"string\" },\n                    website: { type: \"string\" },\n                    tags: { type: \"array\", items: { type: \"string\" } },\n                    stars: { type: \"number\" },\n                    checkin_time: { type: \"string\" },\n                    checkout_time: { type: \"string\" },\n                    room_types: { type: \"array\", items: { type: \"string\" } },\n                  },\n                  required: [\"name\", \"price\"],\n                  additionalProperties: false,\n                },\n              },\n              attractions: {\n                type: \"array\",\n                items: {\n                  type: \"object\",\n                  properties: {\n                    name: { type: \"string\" },\n                    ticket: { oneOf: [{ type: \"number\" }, { type: \"string\" }] },\n                    best_time: { type: \"string\" },\n                    tips: { type: \"string\" },\n                    photo_spots: { type: \"array\", items: { type: \"string\" } },\n                    address: { type: \"string\" },\n                    opening_hours: { type: \"string\" },\n                    website: { type: \"string\" },\n                    tags: { type: \"array\", items: { type: \"string\" } },\n                    location: { type: \"object\", properties: { lat: { type: \"number\" }, lng: { type: \"number\" } }, additionalProperties: false },\n                    durationEstimate: { type: \"number\" },\n                  },\n                  required: [\"name\", \"ticket\"],\n                  additionalProperties: false,\n                },\n              },\n            },\n            required: [\"date\", \"items\"],\n            additionalProperties: false,\n          },\n        },\n        markers: {\n          type: \"array\",\n          items: {\n            type: \"object\",\n            properties: {\n              position: { type: \"array\", items: { type: \"number\" }, minItems: 2, maxItems: 2 },\n              title: { type: \"string\" },\n            },\n            required: [\"position\"],\n            additionalProperties: false,\n          },\n        },\n      },\n      required: [\"destination\", \"start_date\", \"end_date\", \"days\"],\n      additionalProperties: false,\n    };\n    const sys = `你是一位资深的旅游规划师，请根据用户偏好生成结构化行程。严格只输出 JSON（不要输出任何非JSON文字与代码块）。必须严格遵循以下 Schema：${JSON.stringify(\n      schemaSnippet\n    )}。字段名与层级必须完全一致：顶层仅允许 id、destination、start_date、end_date、days、markers；每天(day)仅允许 date、items、routePath、transport、dining、lodging、attractions。禁止使用任何替代字段名（如 schedule/accommodation/food/hotel 等）。生成要求：\\n- 顶层必须包含 destination、start_date、end_date、days（尽量提供 id 与 markers）。\\n- 覆盖从 ${start_date} 到 ${end_date} 的每一天；每天必须包含住宿(lodging)至少 1 条，且是具体酒店中文名。\\n- 每天按节奏 ${pace} 生成 ${slots.length} 个活动；每个时段 items 必须给出具体去的地点(place.name)，不可使用泛化描述（如“城市核心景区打卡”）。\\n- 所有餐饮/住宿/景点必须返回准确中文名字（如能提供地址/营业时间/电话/网站/标签请一并给出）；name 字段必须为具体店名/景点名，不能是类别或模糊词（如“本地餐厅”、“市中心酒店”、“核心景区”等）。\\n- 严格的地域约束：餐饮/住宿/景点/活动地点必须位于“${destination}”及其辖区内，禁止返回其它城市（例如与 ${destination} 无关的店名，如出现跨城请改为本地等价选项）。\\n- items.title 应含具体地点名称，并填写 time；如可估算请提供 durationEstimate 与 costEstimate。\\n- 给出交通(方式/耗时/费用)、餐饮(价格区间/定位)、住宿(价格/定位/星级/入住退房)、景点(门票/最佳游览时间/提示/打卡点/定位等)。\\n- 活动内容逐日保持差异化，避免重复。尽量匹配兴趣偏好：${interests.join(\"/\") || \"无\"}。\\n- 参考时间：${slots.map((_, i) => defaultSlotTime(i)).join(\"、\")}。\\n- 预算约束：${budgetTotal !== undefined ? `用户总预算为 ¥${Math.round(budgetTotal)}。请按照该预算安排交通、餐饮、住宿与门票等支出；最终估算总费用与用户预算的差额不得超过 ¥1000。若超出，请调整选项以满足约束。` : `若用户提供预算，请严格按照预算进行安排，并确保最终估算总费用与预算差额不超过 ¥1000。`}\\n- 费用字段请尽量给出可计算的数值：items.costEstimate（元）、transport.priceEstimate（元）、dining.priceRange（两端为元）、lodging.price（元）、attractions.ticket（元或可解析的字符串）。\\n- markers 如提供，请按照 [lng,lat] 与 title 输出，优先使用参考POI或景点/餐饮/住宿位置。`;\n    const sys2 = `你是一位资深的旅游规划师，只输出严格 JSON（不允许任何非JSON内容）。必须严格遵循以下 Schema：${JSON.stringify(schemaSnippet)}。字段名与层级必须与 Schema 完全一致：\\n- 顶层仅允许 id、destination、start_date、end_date、days、markers。\\n- 每天(day)允许字段：date、items、routePath、transport、dining、lodging、attractions。\\n- 禁止使用任何替代字段名（如 schedule/accommodation/food/hotel 等）。\\n生成规则（务必遵守以保证预算展示完整）：\\n- 覆盖 ${start_date} 到 ${end_date} 每天；每天 lodging 只给 1 条且是具体酒店中文名；dining 必须恰好 3 条（早餐/午餐/晚餐）；attractions ≤2。\\n- 每天按节奏 ${pace} 生成 ${slots.length} 个活动；items 每条必须包含 place.name 与 time，并给出 costEstimate（元）。\\n- transport 必须包含 mode、timeEstimate（分钟）、priceEstimate（元）；dining 必须给出 priceRange [min,max]（元）；lodging 必须给出 price（元）；attractions 必须给出 ticket（可为数值或可解析字符串）。\\n- 名称必须为具体店名/景点名，禁止模糊词（如“本地餐厅”、“市中心酒店”、“核心景区”等）。\\n- 严格地域约束：所有地点必须在“${destination}”辖区内，若跨城请改为本地等价选项。\\n- 预算约束：${budgetTotal !== undefined ? `总预算 ¥${Math.round(budgetTotal)}，确保与预算差额不超过 ¥1000；餐饮为人均价，请按人数 ${Math.max(1, peopleCount)} 倍计入；门票同样按人数 ${Math.max(1, peopleCount)} 倍计入。` : `若提供预算，确保与预算差额不超过 ¥1000；餐饮/门票为人均价时按人数倍数计入。`}\\n- markers 如提供，请按 [lng,lat] 与 title 输出。\\n- 最终输出必须是完整闭合的 JSON，无尾逗号，无截断，无额外文本。`;\n    const user = `目的地:${destination}; 日期范围:${start_date}~${end_date}; 人数:${Math.max(1, peopleCount)}; ${budgetTotal !== undefined ? `预算总额:¥${Math.round(budgetTotal)}; ` : \"\"}参考POI:${candidatePOIs\n      .map((p) => `${p.name}(${p.lng},${p.lat})`)\n      .join(\";\")}`;\n    const baseBody: any = {\n      model,\n      messages: [\n        { role: \"system\", content: sys2 },\n        { role: \"user\", content: user },\n      ],\n      temperature: Number(process.env.DOUBAO_TEMPERATURE ?? 0.2),\n      max_tokens: Number(process.env.DOUBAO_MAX_TOKENS ?? 3500),\n    };\n    try {\n      const tryCall = async (format: \"object\" | \"schema\" | \"none\") => {\n        const body =\n          format === \"schema\"\n            ? { ...baseBody, response_format: { type: \"json_schema\", json_schema: { name: \"plan_schema\", schema: schemaSnippet } } }\n            : format === \"object\"\n            ? { ...baseBody, response_format: { type: \"json_object\" } }\n            : baseBody;\n        const resp = await fetch(url, {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${apiKey}`,\n          },\n          body: JSON.stringify(body),\n        });\n        const data = await resp.json().catch(() => null as any);\n        return { resp, data } as const;\n      };\n      // First attempt: use json_object for structured output (更多端点支持此模式)\n      let { resp, data } = await tryCall(\"object\");\n      if (!resp.ok) {\n        console.warn(\"[plan/create] Doubao call #1 failed (json_object)\", { status: resp.status, error: data?.error });\n      }\n      // If response_format.type not supported, try json_schema; if still not ok, try no format\n      if (\n        data && (\n          data.error?.param === \"response_format.type\" ||\n          /response_format\\.type/.test(String(data.error?.message || \"\")) ||\n          String(data.error?.param || \"\").startsWith(\"response_format.\")\n        )\n      ) {\n        ({ resp, data } = await tryCall(\"schema\"));\n        if (!resp.ok) {\n          console.warn(\"[plan/create] Doubao call #2 failed (json_schema)\", { status: resp.status, error: data?.error });\n          ({ resp, data } = await tryCall(\"none\"));\n          if (!resp.ok) {\n            console.warn(\"[plan/create] Doubao call #3 failed (no format)\", { status: resp.status, error: data?.error });\n          }\n        }\n      }\n      if (!resp.ok || !data) {\n        console.warn(\"[plan/create] Doubao call failed: no ok response or empty data\", { ok: resp.ok, status: resp.status });\n        return null;\n      }\n      const content = data?.choices?.[0]?.message?.content ?? \"\";\n      let obj: any = null;\n      if (typeof content === \"string\") {\n        try {\n          obj = JSON.parse(content);\n        } catch {\n          // 尝试更宽松的 JSON 提取：去除代码块围栏、截取花括号区域、移除可能的尾逗号\n          let s = content;\n          s = s.replace(/```[a-zA-Z]*\\n?/g, \"\").replace(/```/g, \"\");\n          const m = s.match(/\\{[\\s\\S]*\\}/);\n          if (m) {\n            let candidate = m[0];\n            candidate = candidate.replace(/,\\s*([\\}\\]])/g, \"$1\");\n            try { obj = JSON.parse(candidate); } catch {}\n          }\n        }\n      } else {\n        obj = content;\n      }\n      if (!obj) {\n        console.warn(\"[plan/create] Doubao content parse failed or empty\", { preview: typeof content === \"string\" ? String(content).slice(0, 200) : typeof content });\n        return null;\n      }\n      const rawDays = Array.isArray(obj?.days) ? obj.days : [];\n      // First path: well-formed days\n      if (rawDays.length && Array.isArray(rawDays[0]?.items)) {\n        let days = rawDays.map((d: any) => ({\n          date: String(d.date || \"\").slice(0, 10) || fmtDateLocal(allDays[0]),\n          items: (Array.isArray(d.items) ? d.items : []).map((it: any, idx: number) => ({\n            id: `${String(d.date || fmtDateLocal(allDays[0]))}-${idx}`,\n            time: String(it.time || \"\"),\n            title: String(it.title || \"待定\"),\n            note: it.note ? String(it.note) : undefined,\n            place:\n              it.place && typeof it.place === \"object\"\n                ? {\n                    name: String(it.place.name || \"\"),\n                    location:\n                      it.place.location && typeof it.place.location === \"object\"\n                        ? { lat: Number(it.place.location.lat), lng: Number(it.place.location.lng) }\n                        : undefined,\n                    address: it.place.address ? String(it.place.address) : undefined,\n                    poiId: it.place.poiId ? String(it.place.poiId) : undefined,\n                    category: it.place.category ? String(it.place.category) : undefined,\n                  }\n                : undefined,\n            durationEstimate: it.durationEstimate ? Number(it.durationEstimate) : undefined,\n            costEstimate: it.costEstimate ? Number(it.costEstimate) : undefined,\n          })),\n          routePath: Array.isArray(d.routePath)\n            ? d.routePath\n                .map((p: any) => ({ lat: Number(p?.lat), lng: Number(p?.lng) }))\n                .filter((p: any) => Number.isFinite(p.lat) && Number.isFinite(p.lng))\n            : undefined,\n          transport:\n            d.transport && typeof d.transport === \"object\"\n              ? {\n                  mode: String(d.transport.mode || \"transit\"),\n                  steps: Array.isArray(d.transport.steps) ? d.transport.steps.map((s: any) => String(s)) : undefined,\n                  timeEstimate: d.transport.timeEstimate ? Number(d.transport.timeEstimate) : undefined,\n                  priceEstimate: d.transport.priceEstimate ? Number(d.transport.priceEstimate) : undefined,\n                }\n              : undefined,\n          dining: Array.isArray(d.dining)\n            ? d.dining.map((r: any) => ({\n                name: String(r?.name || \"餐馆\"),\n                cuisine: r?.cuisine ? String(r.cuisine) : undefined,\n                priceRange: Array.isArray(r?.priceRange) && r.priceRange.length === 2 ? [Number(r.priceRange[0]), Number(r.priceRange[1])] : undefined,\n                rating: r?.rating ? Number(r.rating) : undefined,\n                distance: r?.distance ? Number(r.distance) : undefined,\n                booking: typeof r?.booking === \"boolean\" ? r.booking : undefined,\n                location: r?.location && typeof r.location === \"object\" ? { lat: Number(r.location.lat), lng: Number(r.location.lng) } : undefined,\n                address: r?.address ? String(r.address) : undefined,\n                phone: r?.phone ? String(r.phone) : undefined,\n                opening_hours: r?.opening_hours ? String(r.opening_hours) : undefined,\n                website: r?.website ? String(r.website) : undefined,\n                tags: Array.isArray(r?.tags) ? r.tags.map((t: any) => String(t)) : undefined,\n              }))\n            : undefined,\n          lodging: Array.isArray(d.lodging)\n            ? d.lodging.map((h: any) => ({\n                name: String(h?.name || \"酒店\"),\n                area: h?.area ? String(h.area) : undefined,\n                price: h?.price ? Number(h.price) : undefined,\n                rating: h?.rating ? Number(h.rating) : undefined,\n                distanceToCore: h?.distanceToCore ? Number(h.distanceToCore) : undefined,\n                amenities: Array.isArray(h?.amenities) ? h.amenities.map((a: any) => String(a)) : undefined,\n                location: h?.location && typeof h.location === \"object\" ? { lat: Number(h.location.lat), lng: Number(h.location.lng) } : undefined,\n                address: h?.address ? String(h.address) : undefined,\n                phone: h?.phone ? String(h.phone) : undefined,\n                opening_hours: h?.opening_hours ? String(h.opening_hours) : undefined,\n                website: h?.website ? String(h.website) : undefined,\n                tags: Array.isArray(h?.tags) ? h.tags.map((t: any) => String(t)) : undefined,\n                stars: h?.stars ? Number(h.stars) : undefined,\n                checkin_time: h?.checkin_time ? String(h.checkin_time) : undefined,\n                checkout_time: h?.checkout_time ? String(h.checkout_time) : undefined,\n                room_types: Array.isArray(h?.room_types) ? h.room_types.map((rt: any) => String(rt)) : undefined,\n              }))\n            : undefined,\n          attractions: Array.isArray(d.attractions)\n            ? d.attractions.map((a: any) => ({\n                name: String(a?.name || \"景点\"),\n                ticket: typeof a?.ticket === \"number\" ? a.ticket : a?.ticket ? String(a.ticket) : undefined,\n                best_time: a?.best_time ? String(a.best_time) : undefined,\n                tips: a?.tips ? String(a.tips) : undefined,\n                photo_spots: Array.isArray(a?.photo_spots) ? a.photo_spots.map((p: any) => String(p)) : undefined,\n                address: a?.address ? String(a.address) : undefined,\n                opening_hours: a?.opening_hours ? String(a.opening_hours) : undefined,\n                website: a?.website ? String(a.website) : undefined,\n                tags: Array.isArray(a?.tags) ? a.tags.map((t: any) => String(t)) : undefined,\n                location: a?.location && typeof a.location === \"object\" ? { lat: Number(a.location.lat), lng: Number(a.location.lng) } : undefined,\n                durationEstimate: a?.durationEstimate ? Number(a.durationEstimate) : undefined,\n              }))\n            : undefined,\n        }));\n        // 目的地地域校验：过滤掉明显跨城的餐饮/住宿/景点/活动地点\n        const cityKeywords = [\n          \"北京\",\"天津\",\"上海\",\"重庆\",\"广州\",\"深圳\",\"杭州\",\"苏州\",\"南京\",\"武汉\",\"成都\",\"西安\",\"青岛\",\"大连\",\"沈阳\",\"长春\",\"哈尔滨\",\"济南\",\"郑州\",\"佛山\",\"宁波\",\"无锡\",\"厦门\",\"福州\",\"合肥\",\"长沙\",\"南昌\",\"昆明\",\"石家庄\",\"太原\",\"兰州\",\"呼和浩特\",\"贵阳\",\"南宁\",\"海口\",\"唐山\",\"保定\"\n        ];\n        const destKey = cityKeywords.find((c) => destination.includes(c)) || destination;\n        const includesOtherCity = (s?: string) => {\n          if (!s) return false;\n          const hasDest = s.includes(destKey);\n          const other = cityKeywords.some((c) => s.includes(c) && c !== destKey);\n          return !hasDest && other;\n        };\n        const bounds = (() => {\n          if (!candidatePOIs.length) return null;\n          const lats = candidatePOIs.map((p) => p.lat);\n          const lngs = candidatePOIs.map((p) => p.lng);\n          const padLat = 1.5;\n          const padLng = 1.5;\n          return { minLat: Math.min(...lats) - padLat, maxLat: Math.max(...lats) + padLat, minLng: Math.min(...lngs) - padLng, maxLng: Math.max(...lngs) + padLng };\n        })();\n        const inBounds = (loc?: { lat?: number; lng?: number }) => {\n          if (!bounds || !loc || !Number.isFinite(loc.lat!) || !Number.isFinite(loc.lng!)) return true;\n          return loc.lat! >= bounds.minLat && loc.lat! <= bounds.maxLat && loc.lng! >= bounds.minLng && loc.lng! <= bounds.maxLng;\n        };\n        const isLocal = (name?: string, address?: string, loc?: { lat?: number; lng?: number }) => {\n          if (includesOtherCity(name) || includesOtherCity(address)) return false;\n          if (!inBounds(loc)) return false;\n          return true;\n        };\n        days = days.map((d: any) => ({\n          ...d,\n          items: d.items.map((it: any) => {\n            const loc = it.place?.location;\n            const nm = it.place?.name || it.title;\n            if (it.place && !isLocal(nm, it.place?.address, loc)) {\n              // 若地点明显跨城，保留标题但去掉 place 以避免误导\n              const { place, ...rest } = it;\n              return { ...rest };\n            }\n            return it;\n          }),\n          dining: Array.isArray(d.dining) ? d.dining.filter((r: any) => isLocal(r?.name, r?.address, r?.location)) : d.dining,\n          lodging: Array.isArray(d.lodging) ? d.lodging.filter((h: any) => isLocal(h?.name, h?.address, h?.location)) : d.lodging,\n          attractions: Array.isArray(d.attractions) ? d.attractions.filter((a: any) => isLocal(a?.name, a?.address, a?.location)) : d.attractions,\n        }));\n        // 解析 markers（若模型已提供）\n        const rawMarkers = Array.isArray(obj?.markers) ? obj.markers : [];\n        const markers: Marker[] | undefined = rawMarkers\n          .map((m: any) => {\n            const pos = Array.isArray(m?.position) ? m.position : null;\n            const lng = Number(pos?.[0]);\n            const lat = Number(pos?.[1]);\n            if (Number.isFinite(lng) && Number.isFinite(lat)) {\n              return { position: [lng, lat], title: m?.title ? String(m.title) : undefined } as Marker;\n            }\n            return null;\n          })\n          .filter(Boolean) as Marker[];\n        return { days, markers };\n      }\n      // Second path: repair from flat or malformed structure\n      const allDates = allDays.map((d) => fmtDateLocal(d));\n      const days = repairDays({ rawDays, allDates, destination, pace });\n      const rawMarkers = Array.isArray(obj?.markers) ? obj.markers : [];\n      const markers: Marker[] | undefined = rawMarkers\n        .map((m: any) => {\n          const pos = Array.isArray(m?.position) ? m.position : null;\n          const lng = Number(pos?.[0]);\n          const lat = Number(pos?.[1]);\n          if (Number.isFinite(lng) && Number.isFinite(lat)) {\n            return { position: [lng, lat], title: m?.title ? String(m.title) : undefined } as Marker;\n          }\n          return null;\n        })\n        .filter(Boolean) as Marker[];\n      return { days, markers };\n    } catch {\n      return null;\n    }\n  }\n\n  // 针对较长日期范围的稳健策略：分日生成并合并。\n  // 当一次性生成失败时，逐日调用模型，显著降低截断与结构不合规概率。\n  async function generateByDaysIndividually(): Promise<{ days: PlanDay[]; markers?: Marker[] } | null> {\n    const apiKey = process.env.DOUBAO_API_KEY;\n    const model = process.env.DOUBAO_MODEL;\n    const base = process.env.DOUBAO_API_BASE || \"\";\n    if (!apiKey || !model || !base) return null;\n    const url = base.replace(/\\/$/, \"\") + \"/chat/completions\";\n\n    const concurrency = Math.max(1, Number(process.env.PER_DAY_CONCURRENCY ?? 2));\n    const outDays: (PlanDay | null)[] = new Array(allDays.length).fill(null);\n    const outMarkers: Marker[][] = new Array(allDays.length).fill([]);\n    let idx = 0;\n\n    const worker = async () => {\n      while (true) {\n        const pos = idx++;\n        if (pos >= allDays.length) break;\n        const d = allDays[pos];\n        const sd = fmtDateLocal(d);\n        const ed = fmtDateLocal(d);\n\n        const schemaSnippet = {\n          type: \"object\",\n          properties: {\n            id: { type: \"string\" },\n            destination: { type: \"string\" },\n            start_date: { type: \"string\" },\n            end_date: { type: \"string\" },\n            days: { type: \"array\", items: { type: \"object\", properties: { date: { type: \"string\" }, items: { type: \"array\" } }, required: [\"date\", \"items\"], additionalProperties: false } },\n            markers: { type: \"array\", items: { type: \"object\", properties: { position: { type: \"array\", items: { type: \"number\" }, minItems: 2, maxItems: 2 }, title: { type: \"string\" } }, required: [\"position\"], additionalProperties: false } },\n          },\n          required: [\"destination\", \"start_date\", \"end_date\", \"days\"],\n          additionalProperties: false,\n        } as any;\n        const sys2 = `只输出严格 JSON；字段与层级必须与 Schema 完全一致：${JSON.stringify(schemaSnippet)}。生成 ${sd} 到 ${ed} 的单日行程；每天：lodging 仅 1 条且为具体酒店；dining 恰好 3 条（早餐/午餐/晚餐）；attractions ≤2；items 必须含 place.name、time 与 costEstimate；transport 必填 mode/timeEstimate/priceEstimate；所有地点必须在“${destination}”。预算约束：${budgetTotal !== undefined ? `总预算 ¥${Math.round(budgetTotal)}，确保与预算差额不超过 ¥1000；餐饮/门票按人数 ${Math.max(1, peopleCount)} 倍计入。` : `若提供预算，确保与预算差额不超过 ¥1000；餐饮/门票按人数倍数计入。`}最终输出为完整闭合 JSON。`;\n        const user = `目的地:${destination}; 日期范围:${sd}~${ed}; 人数:${Math.max(1, peopleCount)}; 参考POI:${candidatePOIs.map((p) => `${p.name}(${p.lng},${p.lat})`).join(\";\")}`;\n        const baseBody: any = {\n          model,\n          messages: [\n            { role: \"system\", content: sys2 },\n            { role: \"user\", content: user },\n          ],\n          temperature: Number(process.env.DOUBAO_TEMPERATURE ?? 0.2),\n          // 单日生成不需要过高的 token 上限，降低可提升速度\n          max_tokens: Math.min(Number(process.env.DOUBAO_MAX_TOKENS ?? 3500), 1800),\n        };\n        const tryCall = async (format: \"object\" | \"schema\" | \"none\") => {\n          const body =\n            format === \"schema\"\n              ? { ...baseBody, response_format: { type: \"json_schema\", json_schema: { name: \"plan_schema\", schema: schemaSnippet } } }\n              : format === \"object\"\n              ? { ...baseBody, response_format: { type: \"json_object\" } }\n              : baseBody;\n          const resp = await fetch(url, { method: \"POST\", headers: { \"Content-Type\": \"application/json\", Authorization: `Bearer ${apiKey}` }, body: JSON.stringify(body) });\n          const data = await resp.json().catch(() => null as any);\n          return { resp, data } as const;\n        };\n        let { resp, data } = await tryCall(\"object\");\n        if (!resp.ok) {\n          ({ resp, data } = await tryCall(\"schema\"));\n          if (!resp.ok) {\n            ({ resp, data } = await tryCall(\"none\"));\n          }\n        }\n        if (!resp.ok || !data) {\n          outDays[pos] = null;\n          outMarkers[pos] = [];\n          continue;\n        }\n        const content = data?.choices?.[0]?.message?.content ?? \"\";\n        let obj: any = null;\n        if (typeof content === \"string\") {\n          try { obj = JSON.parse(content); } catch {\n            let s = content; s = s.replace(/```[a-zA-Z]*\\n?/g, \"\").replace(/```/g, \"\");\n            const m = s.match(/\\{[\\s\\S]*\\}/); if (m) { let candidate = m[0]; candidate = candidate.replace(/,\\s*([\\}\\]])/g, \"$1\"); try { obj = JSON.parse(candidate); } catch {}\n            }\n          }\n        } else { obj = content; }\n        const rawDays = Array.isArray(obj?.days) ? obj.days : [];\n        if (rawDays.length && Array.isArray(rawDays[0]?.items)) {\n          const single = rawDays[0];\n          const parsed: PlanDay = {\n            date: String(single.date || sd).slice(0, 10) || sd,\n            items: (Array.isArray(single.items) ? single.items : []).map((it: any, idx2: number) => ({\n              id: `${sd}-${idx2}`,\n              time: String(it.time || \"\"),\n              title: String(it.title || \"待定\"),\n              note: it.note ? String(it.note) : undefined,\n              place: it.place && typeof it.place === \"object\" ? { name: String(it.place.name || \"\"), location: it.place.location && typeof it.place.location === \"object\" ? { lat: Number(it.place.location.lat), lng: Number(it.place.location.lng) } : undefined, address: it.place.address ? String(it.place.address) : undefined, poiId: it.place.poiId ? String(it.place.poiId) : undefined, category: it.place.category ? String(it.place.category) : undefined } : undefined,\n              durationEstimate: it.durationEstimate ? Number(it.durationEstimate) : undefined,\n              costEstimate: it.costEstimate ? Number(it.costEstimate) : undefined,\n            })),\n            routePath: Array.isArray(single.routePath) ? single.routePath.map((p: any) => ({ lat: Number(p?.lat), lng: Number(p?.lng) })).filter((p: any) => Number.isFinite(p.lat) && Number.isFinite(p.lng)) : undefined,\n            transport: single.transport && typeof single.transport === \"object\" ? { mode: String(single.transport.mode || \"transit\"), steps: Array.isArray(single.transport.steps) ? single.transport.steps.map((s: any) => String(s)) : undefined, timeEstimate: single.transport.timeEstimate ? Number(single.transport.timeEstimate) : undefined, priceEstimate: single.transport.priceEstimate ? Number(single.transport.priceEstimate) : undefined } : undefined,\n            dining: Array.isArray(single.dining) ? single.dining.map((r: any) => ({ name: String(r?.name || \"餐馆\"), cuisine: r?.cuisine ? String(r.cuisine) : undefined, priceRange: Array.isArray(r?.priceRange) && r.priceRange.length === 2 ? [Number(r.priceRange[0]), Number(r.priceRange[1])] : undefined, rating: r?.rating ? Number(r.rating) : undefined, distance: r?.distance ? Number(r.distance) : undefined, booking: typeof r?.booking === \"boolean\" ? r.booking : undefined, location: r?.location && typeof r.location === \"object\" ? { lat: Number(r.location.lat), lng: Number(r.location.lng) } : undefined, address: r?.address ? String(r.address) : undefined, phone: r?.phone ? String(r.phone) : undefined, opening_hours: r?.opening_hours ? String(r.opening_hours) : undefined, website: r?.website ? String(r.website) : undefined, tags: Array.isArray(r?.tags) ? r.tags.map((t: any) => String(t)) : undefined })) : undefined,\n            lodging: Array.isArray(single.lodging) ? single.lodging.map((h: any) => ({ name: String(h?.name || \"酒店\"), area: h?.area ? String(h.area) : undefined, price: h?.price ? Number(h.price) : undefined, rating: h?.rating ? Number(h.rating) : undefined, distanceToCore: h?.distanceToCore ? Number(h.distanceToCore) : undefined, amenities: Array.isArray(h?.amenities) ? h.amenities.map((a: any) => String(a)) : undefined, location: h?.location && typeof h.location === \"object\" ? { lat: Number(h.location.lat), lng: Number(h.location.lng) } : undefined, address: h?.address ? String(h.address) : undefined, phone: h?.phone ? String(h.phone) : undefined, opening_hours: h?.opening_hours ? String(h.opening_hours) : undefined, website: h?.website ? String(h.website) : undefined, tags: Array.isArray(h?.tags) ? h.tags.map((t: any) => String(t)) : undefined, stars: h?.stars ? Number(h.stars) : undefined, checkin_time: h?.checkin_time ? String(h.checkin_time) : undefined, checkout_time: h?.checkout_time ? String(h.checkout_time) : undefined, room_types: Array.isArray(h?.room_types) ? h.room_types.map((rt: any) => String(rt)) : undefined })) : undefined,\n            attractions: Array.isArray(single.attractions) ? single.attractions.map((a: any) => ({ name: String(a?.name || \"景点\"), ticket: typeof a?.ticket === \"number\" ? a.ticket : a?.ticket ? String(a.ticket) : undefined, best_time: a?.best_time ? String(a.best_time) : undefined, tips: a?.tips ? String(a.tips) : undefined, photo_spots: Array.isArray(a?.photo_spots) ? a.photo_spots.map((p: any) => String(p)) : undefined, address: a?.address ? String(a.address) : undefined, opening_hours: a?.opening_hours ? String(a.opening_hours) : undefined, website: a?.website ? String(a.website) : undefined, tags: Array.isArray(a?.tags) ? a.tags.map((t: any) => String(t)) : undefined, location: a?.location && typeof a.location === \"object\" ? { lat: Number(a.location.lat), lng: Number(a.location.lng) } : undefined, durationEstimate: a?.durationEstimate ? Number(a.durationEstimate) : undefined })) : undefined,\n          } as any;\n          outDays[pos] = parsed;\n          const rawMarkers = Array.isArray(obj?.markers) ? obj.markers : [];\n          const markers: Marker[] = rawMarkers.map((m: any) => { const posi = Array.isArray(m?.position) ? m.position : null; const lng = Number(posi?.[0]); const lat = Number(posi?.[1]); if (Number.isFinite(lng) && Number.isFinite(lat)) { return { position: [lng, lat], title: m?.title ? String(m.title) : undefined } as Marker; } return null; }).filter(Boolean) as Marker[];\n          outMarkers[pos] = markers;\n        } else {\n          outDays[pos] = null;\n          outMarkers[pos] = [];\n        }\n      }\n    };\n\n    await Promise.all(Array.from({ length: concurrency }, () => worker()));\n    if (outDays.every((d) => d !== null)) {\n      const days = outDays.filter(Boolean) as PlanDay[];\n      const merged: Marker[] = [];\n      const seen = new Set<string>();\n      for (const arr of outMarkers) {\n        for (const m of arr) {\n          const k = `${m.position[0].toFixed(6)}_${m.position[1].toFixed(6)}_${m.title || \"\"}`;\n          if (seen.has(k)) continue; seen.add(k); merged.push(m);\n        }\n      }\n      return { days, markers: merged };\n    }\n    return null;\n  }\n\n  let generated = await generatePlanWithDoubao();\n  let days: PlanDay[] | null = generated?.days || null;\n  let source: \"llm\" | \"fallback\" = days ? \"llm\" : \"fallback\";\n  // 若一次性生成失败且日期超过2天，尝试分日生成以提升成功率\n  if (!days && allDays.length > 2) {\n    const perDay = await generateByDaysIndividually();\n    if (perDay?.days?.length) {\n      days = perDay.days;\n      generated = perDay;\n      source = \"llm\";\n    }\n  }\n  if (!days) {\n    // 本地回退生成\n    days = allDays.map((d, i) => {\n      const dateStr = fmtDateLocal(d);\n      const pick = (j: number) => candidatePOIs[j % (candidatePOIs.length || 1)];\n      const items: PlanItem[] = slots.map((slot, idx) => {\n        const poi = pick(i * 3 + idx);\n        return {\n          id: `${dateStr}-${idx}`,\n          time: defaultSlotTime(idx),\n          title: `${poi.name} 深度体验 (${slot})`,\n          note: idx === 0 ? \"推荐乘船或湖畔步行，拍摄经典机位\" : idx === 1 ? \"文化打卡与美食探店结合\" : \"夜游街区，品尝当地小吃\",\n          place: { name: poi.name, location: { lat: poi.lat, lng: poi.lng } },\n          durationEstimate: 90,\n          costEstimate: idx === 0 ? 50 : idx === 1 ? 80 : 30,\n        } as any;\n      });\n      const isWuhan = /武汉|Wuhan/i.test(destination);\n      const isHangzhou = /杭州|Hangzhou/i.test(destination);\n      const dining = isWuhan\n        ? [\n            { name: \"蔡林记(户部巷店)\", cuisine: \"武汉小吃\", priceRange: [20, 40], rating: 4.5, location: candidatePOIs[0] ? { lat: candidatePOIs[0].lat, lng: candidatePOIs[0].lng } : undefined, address: \"武昌区户部巷\", phone: \"027-xxx\", opening_hours: \"06:30-21:30\", tags: [\"热干面\",\"老字号\"] },\n            { name: \"四季美汤包(楚河汉街店)\", cuisine: \"汤包/小吃\", priceRange: [25, 60], rating: 4.4, location: candidatePOIs[1] ? { lat: candidatePOIs[1].lat, lng: candidatePOIs[1].lng } : undefined, address: \"楚河汉街\", phone: \"027-xxx\", opening_hours: \"07:00-21:30\", tags: [\"人气\",\"本地人\"] },\n            { name: \"周黑鸭(江汉路总店)\", cuisine: \"卤味\", priceRange: [30, 80], rating: 4.3, location: candidatePOIs[2] ? { lat: candidatePOIs[2].lat, lng: candidatePOIs[2].lng } : undefined, address: \"江汉路步行街\", opening_hours: \"10:00-22:00\", tags: [\"伴手礼\"] },\n          ]\n        : isHangzhou\n        ? [\n            { name: \"楼外楼(西湖店)\", cuisine: \"杭帮菜\", priceRange: [80, 180], rating: 4.6, location: candidatePOIs[0] ? { lat: candidatePOIs[0].lat, lng: candidatePOIs[0].lng } : undefined, address: \"西湖风景区孤山路30号\", phone: \"0571-xxx\", opening_hours: \"10:00-20:00\", tags: [\"老字号\",\"湖景\"] },\n            { name: \"外婆家(湖滨银泰)\", cuisine: \"家常菜\", priceRange: [60, 120], rating: 4.5, location: candidatePOIs[1] ? { lat: candidatePOIs[1].lat, lng: candidatePOIs[1].lng } : undefined, address: \"湖滨银泰in77\", phone: \"0571-xxx\", opening_hours: \"11:00-21:30\", tags: [\"人气\",\"排队\"] },\n            { name: \"知味观(总店)\", cuisine: \"小吃\", priceRange: [20, 50], rating: 4.3, location: candidatePOIs[2] ? { lat: candidatePOIs[2].lat, lng: candidatePOIs[2].lng } : undefined, address: \"延安路83号\", opening_hours: \"07:00-21:00\", tags: [\"早点\",\"本地人\"] },\n          ]\n        : [\n            { name: `${destination} 当地菜馆 A`, cuisine: \"地方菜\", priceRange: [50, 120], rating: 4.4, location: candidatePOIs[0] ? { lat: candidatePOIs[0].lat, lng: candidatePOIs[0].lng } : undefined, tags: [\"人气\"] },\n            { name: `${destination} 小吃街 B`, cuisine: \"小吃\", priceRange: [20, 60], rating: 4.2, location: candidatePOIs[1] ? { lat: candidatePOIs[1].lat, lng: candidatePOIs[1].lng } : undefined, tags: [\"本地人\"] },\n            { name: `${destination} 特色餐厅 C`, cuisine: \"特色菜\", priceRange: [80, 180], rating: 4.3, location: candidatePOIs[2] ? { lat: candidatePOIs[2].lat, lng: candidatePOIs[2].lng } : undefined, tags: [\"适合家庭\"] },\n          ];\n      const lodgingArea = isWuhan ? \"楚河汉街/东湖\" : isHangzhou ? \"湖滨/西湖\" : \"市中心\";\n      const lodging = [{ name: `${destination} 精品酒店·日${i + 1}`, area: lodgingArea, price: 420, rating: 4.3, amenities: [\"WiFi\",\"早餐\",\"空调\"], stars: 4, checkin_time: \"14:00\", checkout_time: \"12:00\", location: candidatePOIs[i % (candidatePOIs.length || 1)] ? { lat: candidatePOIs[i % (candidatePOIs.length || 1)].lat, lng: candidatePOIs[i % (candidatePOIs.length || 1)].lng } : undefined }];\n      const transport = { mode: \"transit\", steps: [\"地铁与公交组合\", \"步行 10 分钟\"], timeEstimate: 30, priceEstimate: 20 };\n      const aPick = (j: number) => candidatePOIs[j % (candidatePOIs.length || 1)];\n      const attractions = [\n        { name: `${aPick(i * 2).name || destination} 景点`, ticket: 60, best_time: \"上午\", tips: \"提前购票，错峰入园\", photo_spots: [\"主入口\", \"观景台\"], location: { lat: aPick(i * 2).lat, lng: aPick(i * 2).lng } },\n        { name: `${aPick(i * 2 + 1).name || destination} 景点`, ticket: 80, best_time: \"下午\", tips: \"注意防晒，补水\", photo_spots: [\"湖畔\", \"古街\"], location: { lat: aPick(i * 2 + 1).lat, lng: aPick(i * 2 + 1).lng } },\n      ];\n      const routePath = candidatePOIs.length >= 2\n        ? [\n            { lat: pick(0).lat, lng: pick(0).lng },\n            { lat: pick(1).lat, lng: pick(1).lng },\n          ]\n        : undefined;\n      return { date: dateStr, items, dining, lodging, transport, attractions, routePath } as any;\n    });\n  }\n\n  const markers = (generated?.markers && generated.markers.length ? generated.markers : (candidateMarkers.length ? candidateMarkers : await findCityMarkers(destination)));\n\n  // --- Strong budget enforcement: refine when outside ±1000 of user budget ---\n  if (days && typeof budgetTotal === \"number\") {\n    const { totals } = estimateBudgetTotals(days, peopleCount);\n    const diff = Math.abs(totals.grand - budgetTotal);\n    if (diff > 1000) {\n      const refined = await refinePlanToBudget({ originalDays: days, destination, start_date, end_date, budgetTotal, peopleCount });\n      if (refined && refined.length) {\n        const { totals: newTotals } = estimateBudgetTotals(refined, peopleCount);\n        const newDiff = Math.abs(newTotals.grand - budgetTotal);\n        if (newDiff <= diff) {\n          days = refined;\n        }\n      }\n    }\n  }\n\n  // Ensure each day has exactly 3 dining entries by padding placeholders when missing\n  if (Array.isArray(days)) {\n    days = days.map((d) => {\n      const existing = Array.isArray(d.dining) ? d.dining.slice(0, 3) : [];\n      if (existing.length >= 3) return d;\n      const placeholders: { name: string; priceRange: [number, number] }[] = [\n        { name: `${destination} 早餐推荐`, priceRange: [20, 50] as [number, number] },\n        { name: `${destination} 午餐推荐`, priceRange: [40, 80] as [number, number] },\n        { name: `${destination} 晚餐推荐`, priceRange: [60, 120] as [number, number] },\n      ];\n      const padded = [...existing];\n      for (let i = existing.length; i < 3; i++) padded.push(placeholders[i]);\n      return { ...d, dining: padded } as typeof d;\n    });\n  }\n\n  const data = {\n    id: `generated-${Math.random().toString(36).slice(2, 8)}`,\n    destination,\n    start_date,\n    end_date,\n    days: days!,\n    markers,\n    source,\n  };\n\n  // Validate final data strictly; if invalid, attempt minimal repair and return\n  const validated = PlanDataSchema.safeParse(data);\n  if (!validated.success) {\n    // Minimal repair: ensure dates coverage\n    const allDates = allDays.map((d) => fmtDateLocal(d));\n    const repairedDays = repairDays({ rawDays: data.days, allDates, destination, pace });\n    const repaired = { ...data, days: repairedDays };\n    const reparsed = PlanDataSchema.safeParse(repaired);\n    if (!reparsed.success) {\n      return NextResponse.json({ error: \"generation_failed\", issues: reparsed.error.issues }, { status: 500 });\n    }\n    return NextResponse.json(repaired);\n  }\n  return NextResponse.json(validated.data);\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAEA;;;AAaO,MAAM,UAAU;AAEvB,MAAM,iBAAiB,6KAAmB;AAI1C,SAAS,aAAa,CAAO;IAC3B,OAAO,IAAA,iKAAO,EAAC;AACjB;AAEA,eAAe,gBAAgB,IAAY;IACzC,MAAM,MAAM,QAAQ,GAAG,CAAC,mBAAmB;IAC3C,IAAI,CAAC,KAAK;QACR,OAAO;YACL;gBAAE,UAAU;oBAAC;oBAAY;iBAAS;gBAAE,OAAO,GAAG,KAAK,IAAI,CAAC;YAAC;YACzD;gBAAE,UAAU;oBAAC;oBAAS;iBAAO;gBAAE,OAAO,GAAG,KAAK,IAAI,CAAC;YAAC;SACrD;IACH;IACA,MAAM,SAAS,IAAI,gBAAgB;QACjC;QACA,UAAU;QACV;QACA,WAAW;QACX,QAAQ;IACV;IACA,MAAM,MAAM,CAAC,uCAAuC,EAAE,OAAO,QAAQ,IAAI;IACzE,IAAI;QACF,MAAM,OAAO,MAAM,MAAM;QACzB,MAAM,OAAO,MAAM,KAAK,IAAI;QAC5B,MAAM,OAAc,MAAM,QAAQ,EAAE;QACpC,OAAO,KAAK,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC;YAC3B,MAAM,CAAC,QAAQ,OAAO,GAAG,OAAO,EAAE,QAAQ,IAAI,IAAI,KAAK,CAAC;YACxD,MAAM,MAAM,OAAO;YACnB,MAAM,MAAM,OAAO;YACnB,OAAO;gBAAE,UAAU;oBAAC;oBAAK;iBAAI;gBAAE,OAAO,EAAE,IAAI;YAAC;QAC/C;IACF,EAAE,OAAM;QACN,OAAO;YACL;gBAAE,UAAU;oBAAC;oBAAY;iBAAS;gBAAE,OAAO,GAAG,KAAK,IAAI,CAAC;YAAC;YACzD;gBAAE,UAAU;oBAAC;oBAAS;iBAAO;gBAAE,OAAO,GAAG,KAAK,IAAI,CAAC;YAAC;SACrD;IACH;AACF;AAEA,eAAe,iBAAiB,GAAY;IAC1C,IAAI;QACF,OAAO,MAAM,IAAI,IAAI;IACvB,EAAE,OAAM;QACN,IAAI;YACF,MAAM,OAAO,MAAM,IAAI,IAAI;YAC3B,OAAO,KAAK,KAAK,CAAC;QACpB,EAAE,OAAM;YACN,OAAO,CAAC;QACV;IACF;AACF;AAEA,+DAA+D;AAC/D,SAAS,SAAS,KAAwB;IACxC,IAAI,CAAC,SAAS,MAAM,MAAM,KAAK,GAAG,OAAO;IACzC,MAAM,IAAI,OAAO,KAAK,CAAC,EAAE;IACzB,MAAM,IAAI,OAAO,KAAK,CAAC,EAAE;IACzB,OAAO,OAAO,QAAQ,CAAC,MAAM,OAAO,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,IAAI;AAClE;AAEA,SAAS,eAAe,CAAmB;IACzC,IAAI,KAAK,MAAM,OAAO;IACtB,IAAI,OAAO,MAAM,YAAY,OAAO,QAAQ,CAAC,IAAI,OAAO;IACxD,MAAM,IAAI,OAAO;IACjB,OAAO,OAAO,QAAQ,CAAC,KAAK,IAAI;AAClC;AAEA,SAAS,qBAAqB,IAAe,EAAE,cAAsB,CAAC;IAIpE,MAAM,QAA+H,EAAE;IACvI,IAAI,YAAY,GAAG,SAAS,GAAG,UAAU,GAAG,UAAU,GAAG,QAAQ;IACjE,KAAK,MAAM,KAAK,QAAQ,EAAE,CAAE;QAC1B,MAAM,IAAI,OAAO,EAAE,SAAS,EAAE,kBAAkB;QAChD,MAAM,gBAAgB,CAAC,EAAE,MAAM,IAAI,EAAE,EAAE,MAAM,CAAC,CAAC,GAAG,KAAO,IAAI,SAAS,GAAG,UAAU,GAAU;QAC7F,MAAM,OAAO,gBAAgB,KAAK,GAAG,CAAC,GAAG;QACzC,MAAM,QAAQ,CAAC,EAAE,OAAO,IAAI,EAAE,EAAE,MAAM,CAAC,CAAC,GAAG,KAAO,IAAI,CAAC,OAAO,AAAC,GAAW,KAAK,KAAK,CAAC,GAAG;QACxF,MAAM,mBAAmB,CAAC,EAAE,WAAW,IAAI,EAAE,EAAE,MAAM,CAAC,CAAC,GAAG,KAAO,IAAI,eAAe,AAAC,GAAW,MAAM,GAAG;QACzG,MAAM,OAAO,mBAAmB,KAAK,GAAG,CAAC,GAAG;QAC5C,MAAM,MAAM,CAAC,EAAE,KAAK,IAAI,EAAE,EAAE,MAAM,CAAC,CAAC,GAAG,KAAO,IAAI,CAAC,OAAO,AAAC,GAAW,YAAY,KAAK,CAAC,GAAG;QAC3F,MAAM,QAAQ,IAAI,OAAO,QAAQ,OAAO;QACxC,MAAM,IAAI,CAAC;YAAE,MAAM,EAAE,IAAI;YAAE,WAAW;YAAG,QAAQ;YAAM,SAAS;YAAO,SAAS;YAAM,OAAO;YAAK;QAAM;QACxG,aAAa;QAAG,UAAU;QAAM,WAAW;QAAO,WAAW;QAAM,SAAS;IAC9E;IACA,MAAM,QAAQ,YAAY,SAAS,UAAU,UAAU;IACvD,OAAO;QAAE;QAAO,QAAQ;YAAE;YAAW;YAAQ;YAAS;YAAS;YAAO;QAAM;IAAE;AAChF;AAEA,eAAe,mBAAmB,MAOjC;IACC,MAAM,EAAE,YAAY,EAAE,WAAW,EAAE,UAAU,EAAE,QAAQ,EAAE,WAAW,EAAE,cAAc,CAAC,EAAE,GAAG;IAC1F,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;IACzC,MAAM,QAAQ,QAAQ,GAAG,CAAC,YAAY;IACtC,MAAM,OAAO,QAAQ,GAAG,CAAC,eAAe,IAAI;IAC5C,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,MAAM,OAAO;IACvC,MAAM,MAAM,KAAK,OAAO,CAAC,OAAO,MAAM;IAEtC,qEAAqE;IACrE,MAAM,gBAAqB;QACzB,MAAM;QACN,YAAY;YACV,IAAI;gBAAE,MAAM;YAAS;YACrB,aAAa;gBAAE,MAAM;YAAS;YAC9B,YAAY;gBAAE,MAAM;YAAS;YAC7B,UAAU;gBAAE,MAAM;YAAS;YAC3B,MAAM;gBAAE,MAAM;gBAAS,OAAO;oBAAE,MAAM;oBAAU,YAAY;wBAAE,MAAM;4BAAE,MAAM;wBAAS;wBAAG,OAAO;4BAAE,MAAM;wBAAQ;wBAAG,WAAW;4BAAE,MAAM;wBAAQ;wBAAG,WAAW;4BAAE,MAAM;wBAAS;wBAAG,QAAQ;4BAAE,MAAM;wBAAQ;wBAAG,SAAS;4BAAE,MAAM;wBAAQ;wBAAG,aAAa;4BAAE,MAAM;wBAAQ;oBAAE;oBAAG,UAAU;wBAAC;wBAAQ;qBAAQ;oBAAE,sBAAsB;gBAAM;YAAE;YACnU,SAAS;gBAAE,MAAM;YAAQ;QAC3B;QACA,UAAU;YAAC;YAAe;YAAc;YAAY;SAAO;QAC3D,sBAAsB;IACxB;IAEA,MAAM,MAAM,CAAC,8FAA8F,EAAE,KAAK,KAAK,CACrH,aACA,oBAAoB,EAAE,WAAW,GAAG,EAAE,SAAS,aAAa,EAAE,YAAY,+DAA+D,EAAE,KAAK,GAAG,CACnJ,GACA,aACA,sKAAsK,EAAE,KAAK,SAAS,CACtL,eACA,CAAC,CAAC;IAEJ,MAAM,UAAU;QACd;QACA;QACA;QACA,MAAM;IACR;IAEA,MAAM,WAAgB;QACpB;QACA,UAAU;YACR;gBAAE,MAAM;gBAAU,SAAS;YAAI;YAC/B;gBAAE,MAAM;gBAAQ,SAAS,KAAK,SAAS,CAAC;oBAAE;oBAAa;oBAAa,aAAa;gBAAQ;YAAG;SAC7F;QACD,aAAa,OAAO,QAAQ,GAAG,CAAC,kBAAkB,IAAI;QACtD,YAAY,KAAK,GAAG,CAAC,OAAO,QAAQ,GAAG,CAAC,iBAAiB,IAAI,OAAO;QACpE,iBAAiB;YAAE,MAAM;QAAc;IACzC;IAEA,IAAI;QACF,MAAM,OAAO,MAAM,MAAM,KAAK;YAAE,QAAQ;YAAQ,SAAS;gBAAE,gBAAgB;gBAAoB,eAAe,CAAC,OAAO,EAAE,QAAQ;YAAC;YAAG,MAAM,KAAK,SAAS,CAAC;QAAU;QACnK,MAAM,OAAO,MAAM,KAAK,IAAI,GAAG,KAAK,CAAC,IAAM;QAC3C,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,OAAO;QAC9B,MAAM,UAAU,MAAM,SAAS,CAAC,EAAE,EAAE,SAAS,WAAW;QACxD,IAAI,MAAW;QACf,IAAI,OAAO,YAAY,UAAU;YAC/B,IAAI;gBAAE,MAAM,KAAK,KAAK,CAAC;YAAU,EAAE,OAAM;gBACvC,IAAI,IAAI;gBAAS,IAAI,EAAE,OAAO,CAAC,oBAAoB,IAAI,OAAO,CAAC,QAAQ;gBACvE,MAAM,IAAI,EAAE,KAAK,CAAC;gBAAgB,IAAI,GAAG;oBAAE,IAAI,YAAY,CAAC,CAAC,EAAE;oBAAE,YAAY,UAAU,OAAO,CAAC,iBAAiB;oBAAO,IAAI;wBAAE,MAAM,KAAK,KAAK,CAAC;oBAAY,EAAE,OAAM,CAAC;gBAAE;YACvK;QACF,OAAO;YAAE,MAAM;QAAS;QACxB,MAAM,UAAU,MAAM,OAAO,CAAC,KAAK,QAAQ,IAAI,IAAI,GAAG,EAAE;QACxD,IAAI,CAAC,QAAQ,MAAM,EAAE,OAAO;QAC5B,MAAM,OAAO,QAAQ,GAAG,CAAC,CAAC,GAAQ,KAAe,CAAC;gBAChD,MAAM,OAAO,EAAE,IAAI,IAAI,IAAI,KAAK,CAAC,GAAG,OAAQ,YAAY,CAAC,GAAG,EAAE,QAAQ;gBACtE,OAAO,CAAC,MAAM,OAAO,CAAC,EAAE,KAAK,IAAI,EAAE,KAAK,GAAG,EAAE,EAAE,GAAG,CAAC,CAAC,IAAS,MAAgB,CAAC;wBAC5E,IAAI,GAAG,OAAO,EAAE,IAAI,IAAI,YAAY,CAAC,EAAE,KAAK;wBAC5C,MAAM,OAAO,GAAG,IAAI,IAAI;wBACxB,OAAO,OAAO,GAAG,KAAK,IAAI;wBAC1B,MAAM,GAAG,IAAI,GAAG,OAAO,GAAG,IAAI,IAAI;wBAClC,OAAO,GAAG,KAAK,IAAI,OAAO,GAAG,KAAK,KAAK,WAAW;4BAChD,MAAM,OAAO,GAAG,KAAK,CAAC,IAAI,IAAI;4BAC9B,UAAU,GAAG,KAAK,CAAC,QAAQ,IAAI,OAAO,GAAG,KAAK,CAAC,QAAQ,KAAK,WAAW;gCAAE,KAAK,OAAO,GAAG,KAAK,CAAC,QAAQ,CAAC,GAAG;gCAAG,KAAK,OAAO,GAAG,KAAK,CAAC,QAAQ,CAAC,GAAG;4BAAE,IAAI;4BACpJ,SAAS,GAAG,KAAK,CAAC,OAAO,GAAG,OAAO,GAAG,KAAK,CAAC,OAAO,IAAI;4BACvD,OAAO,GAAG,KAAK,CAAC,KAAK,GAAG,OAAO,GAAG,KAAK,CAAC,KAAK,IAAI;4BACjD,UAAU,GAAG,KAAK,CAAC,QAAQ,GAAG,OAAO,GAAG,KAAK,CAAC,QAAQ,IAAI;wBAC5D,IAAI;wBACJ,kBAAkB,GAAG,gBAAgB,GAAG,OAAO,GAAG,gBAAgB,IAAI;wBACtE,cAAc,GAAG,YAAY,GAAG,OAAO,GAAG,YAAY,IAAI;oBAC5D,CAAC;gBACD,WAAW,MAAM,OAAO,CAAC,EAAE,SAAS,IAAI,EAAE,SAAS,CAAC,GAAG,CAAC,CAAC,IAAW,CAAC;wBAAE,KAAK,OAAO,GAAG;wBAAM,KAAK,OAAO,GAAG;oBAAK,CAAC,GAAG,MAAM,CAAC,CAAC,IAAW,OAAO,QAAQ,CAAC,EAAE,GAAG,KAAK,OAAO,QAAQ,CAAC,EAAE,GAAG,KAAK;gBAC3L,WAAW,EAAE,SAAS,IAAI,OAAO,EAAE,SAAS,KAAK,WAAW;oBAC1D,MAAM,OAAO,EAAE,SAAS,CAAC,IAAI,IAAI;oBACjC,OAAO,MAAM,OAAO,CAAC,EAAE,SAAS,CAAC,KAAK,IAAI,EAAE,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,IAAW,OAAO,MAAM;oBACzF,cAAc,EAAE,SAAS,CAAC,YAAY,GAAG,OAAO,EAAE,SAAS,CAAC,YAAY,IAAI;oBAC5E,eAAe,EAAE,SAAS,CAAC,aAAa,GAAG,OAAO,EAAE,SAAS,CAAC,aAAa,IAAI;gBACjF,IAAI;gBACJ,QAAQ,MAAM,OAAO,CAAC,EAAE,MAAM,IAAI,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC,IAAW,CAAC;wBAC1D,MAAM,OAAO,GAAG,QAAQ;wBACxB,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;wBAC1C,YAAY,MAAM,OAAO,CAAC,GAAG,eAAe,EAAE,UAAU,CAAC,MAAM,KAAK,IAAI;4BAAC,OAAO,EAAE,UAAU,CAAC,EAAE;4BAAG,OAAO,EAAE,UAAU,CAAC,EAAE;yBAAE,GAAG;wBAC7H,QAAQ,GAAG,SAAS,OAAO,EAAE,MAAM,IAAI;wBACvC,UAAU,GAAG,WAAW,OAAO,EAAE,QAAQ,IAAI;wBAC7C,SAAS,OAAO,GAAG,YAAY,YAAY,EAAE,OAAO,GAAG;wBACvD,UAAU,GAAG,YAAY,OAAO,EAAE,QAAQ,KAAK,WAAW;4BAAE,KAAK,OAAO,EAAE,QAAQ,CAAC,GAAG;4BAAG,KAAK,OAAO,EAAE,QAAQ,CAAC,GAAG;wBAAE,IAAI;wBACzH,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;wBAC1C,OAAO,GAAG,QAAQ,OAAO,EAAE,KAAK,IAAI;wBACpC,eAAe,GAAG,gBAAgB,OAAO,EAAE,aAAa,IAAI;wBAC5D,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;wBAC1C,MAAM,MAAM,OAAO,CAAC,GAAG,QAAQ,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,IAAW,OAAO,MAAM;oBACrE,CAAC,KAAK;gBACN,SAAS,MAAM,OAAO,CAAC,EAAE,OAAO,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,CAAC,IAAW,CAAC;wBAC7D,MAAM,OAAO,GAAG,QAAQ;wBACxB,MAAM,GAAG,OAAO,OAAO,EAAE,IAAI,IAAI;wBACjC,OAAO,GAAG,QAAQ,OAAO,EAAE,KAAK,IAAI;wBACpC,QAAQ,GAAG,SAAS,OAAO,EAAE,MAAM,IAAI;wBACvC,gBAAgB,GAAG,iBAAiB,OAAO,EAAE,cAAc,IAAI;wBAC/D,WAAW,MAAM,OAAO,CAAC,GAAG,aAAa,EAAE,SAAS,CAAC,GAAG,CAAC,CAAC,IAAW,OAAO,MAAM;wBAClF,UAAU,GAAG,YAAY,OAAO,EAAE,QAAQ,KAAK,WAAW;4BAAE,KAAK,OAAO,EAAE,QAAQ,CAAC,GAAG;4BAAG,KAAK,OAAO,EAAE,QAAQ,CAAC,GAAG;wBAAE,IAAI;wBACzH,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;wBAC1C,OAAO,GAAG,QAAQ,OAAO,EAAE,KAAK,IAAI;wBACpC,eAAe,GAAG,gBAAgB,OAAO,EAAE,aAAa,IAAI;wBAC5D,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;wBAC1C,MAAM,MAAM,OAAO,CAAC,GAAG,QAAQ,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,IAAW,OAAO,MAAM;wBACnE,OAAO,GAAG,QAAQ,OAAO,EAAE,KAAK,IAAI;wBACpC,cAAc,GAAG,eAAe,OAAO,EAAE,YAAY,IAAI;wBACzD,eAAe,GAAG,gBAAgB,OAAO,EAAE,aAAa,IAAI;wBAC5D,YAAY,MAAM,OAAO,CAAC,GAAG,cAAc,EAAE,UAAU,CAAC,GAAG,CAAC,CAAC,KAAY,OAAO,OAAO;oBACzF,CAAC,KAAK;gBACN,aAAa,MAAM,OAAO,CAAC,EAAE,WAAW,IAAI,EAAE,WAAW,CAAC,GAAG,CAAC,CAAC,IAAW,CAAC;wBACzE,MAAM,OAAO,GAAG,QAAQ;wBACxB,QAAQ,OAAO,GAAG,WAAW,WAAW,EAAE,MAAM,GAAG,GAAG,SAAS,OAAO,EAAE,MAAM,IAAI;wBAClF,WAAW,GAAG,YAAY,OAAO,EAAE,SAAS,IAAI;wBAChD,MAAM,GAAG,OAAO,OAAO,EAAE,IAAI,IAAI;wBACjC,aAAa,MAAM,OAAO,CAAC,GAAG,eAAe,EAAE,WAAW,CAAC,GAAG,CAAC,CAAC,IAAW,OAAO,MAAM;wBACxF,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;wBAC1C,eAAe,GAAG,gBAAgB,OAAO,EAAE,aAAa,IAAI;wBAC5D,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;wBAC1C,MAAM,MAAM,OAAO,CAAC,GAAG,QAAQ,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,IAAW,OAAO,MAAM;wBACnE,UAAU,GAAG,YAAY,OAAO,EAAE,QAAQ,KAAK,WAAW;4BAAE,KAAK,OAAO,EAAE,QAAQ,CAAC,GAAG;4BAAG,KAAK,OAAO,EAAE,QAAQ,CAAC,GAAG;wBAAE,IAAI;wBACzH,kBAAkB,GAAG,mBAAmB,OAAO,EAAE,gBAAgB,IAAI;oBACvE,CAAC,KAAK;YACR,CAAC;QACD,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,KAAK,GAAY;IACrC,MAAM,MAAM,MAAM,iBAAiB;IACnC,sEAAsE;IACtE,IAAI,SAAS;IACb,IAAI;QACF,MAAM,IAAI,IAAI,IAAI,IAAI,GAAG;QACzB,MAAM,KAA6B,CAAC;QACpC,KAAK,MAAM,CAAC,GAAG,EAAE,IAAI,EAAE,YAAY,CAAC,OAAO,GAAI,EAAE,CAAC,EAAE,GAAG;QACvD,SAAS;YAAE,GAAG,EAAE;YAAE,GAAG,GAAG;QAAC;QACzB,oFAAoF;QACpF,IAAI,OAAO,AAAC,OAAe,WAAW,KAAK,UAAU;YACnD,IAAI;gBACD,OAAe,WAAW,GAAG,KAAK,KAAK,CAAC,AAAC,OAAe,WAAW;YACtE,EAAE,OAAM,CAAC;QACX;IACF,EAAE,OAAM,CAAC;IACT,MAAM,SAAS,eAAe,SAAS,CAAC;IACxC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,OAAO,uKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAAgB,QAAQ,OAAO,KAAK,CAAC,MAAM;QAAC,GAAG;YAAE,QAAQ;QAAI;IACjG;IACA,MAAM,EAAE,WAAW,EAAE,UAAU,EAAE,QAAQ,EAAE,WAAW,EAAE,GAAG,IAAA,uKAAa,EAAC,OAAO,IAAI;IAEpF,MAAM,QAAQ,IAAI,KAAK;IACvB,MAAM,MAAM,IAAI,KAAK;IACrB,MAAM,UAAU,IAAA,8KAAoB,EAAC,OAAO;IAE5C,MAAM,OAAO,aAAa,QAAQ;IAClC,MAAM,QAAQ,IAAA,sKAAY,EAAC;IAC3B,MAAM,YAAY,CAAC,aAAa,aAAa,EAAE,EAAE,KAAK,CAAC,GAAG;IAC1D,MAAM,cAAc,OAAO,aAAa,gBAAgB,WAAW,YAAa,WAAW,GAAG;IAC9F,MAAM,cAAc,OAAO,aAAa,gBAAgB,YAAY,YAAa,WAAW,GAAG,IAAI,YAAa,WAAW,GAAG;IAE9H,qCAAqC;IACrC,MAAM,mBAAmB,MAAM,gBAAgB;IAC/C,MAAM,gBAAgB,iBAAiB,GAAG,CAAC,CAAC,IAAM,CAAC;YAAE,MAAM,EAAE,KAAK,IAAI;YAAM,KAAK,EAAE,QAAQ,CAAC,EAAE;YAAE,KAAK,EAAE,QAAQ,CAAC,EAAE;QAAC,CAAC;IAEpH,2CAA2C;IAC3C,eAAe;QACb,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;QACzC,MAAM,QAAQ,QAAQ,GAAG,CAAC,YAAY;QACtC,MAAM,OAAO,QAAQ,GAAG,CAAC,eAAe,IAAI;QAC5C,mDAAmD;QACnD,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,MAAM,OAAO;QACvC,MAAM,MAAM,KAAK,OAAO,CAAC,OAAO,MAAM;QACtC,MAAM,gBAAgB;YACpB,MAAM;YACN,YAAY;gBACV,IAAI;oBAAE,MAAM;gBAAS;gBACrB,aAAa;oBAAE,MAAM;gBAAS;gBAC9B,YAAY;oBAAE,MAAM;gBAAS;gBAC7B,UAAU;oBAAE,MAAM;gBAAS;gBAC3B,MAAM;oBACJ,MAAM;oBACN,OAAO;wBACL,MAAM;wBACN,YAAY;4BACV,MAAM;gCAAE,MAAM;4BAAS;4BACvB,OAAO;gCACL,MAAM;gCACN,OAAO;oCACL,MAAM;oCACN,YAAY;wCACV,MAAM;4CAAE,MAAM;wCAAS;wCACvB,OAAO;4CAAE,MAAM;wCAAS;wCACxB,MAAM;4CAAE,MAAM;wCAAS;wCACvB,OAAO;4CACL,MAAM;4CACN,YAAY;gDACV,MAAM;oDAAE,MAAM;gDAAS;gDACvB,UAAU;oDAAE,MAAM;oDAAU,YAAY;wDAAE,KAAK;4DAAE,MAAM;wDAAS;wDAAG,KAAK;4DAAE,MAAM;wDAAS;oDAAE;oDAAG,sBAAsB;gDAAM;gDAC1H,SAAS;oDAAE,MAAM;gDAAS;gDAC1B,OAAO;oDAAE,MAAM;gDAAS;gDACxB,UAAU;oDAAE,MAAM;gDAAS;4CAC7B;4CACA,UAAU;gDAAC;6CAAO;4CAClB,sBAAsB;wCACxB;wCACA,kBAAkB;4CAAE,MAAM;wCAAS;wCACnC,cAAc;4CAAE,MAAM;wCAAS;oCACjC;oCACA,UAAU;wCAAC;wCAAQ;wCAAS;wCAAS;qCAAe;oCACpD,sBAAsB;gCACxB;4BACF;4BACA,WAAW;gCACT,MAAM;gCACN,OAAO;oCAAE,MAAM;oCAAU,YAAY;wCAAE,KAAK;4CAAE,MAAM;wCAAS;wCAAG,KAAK;4CAAE,MAAM;wCAAS;oCAAE;oCAAG,UAAU;wCAAC;wCAAO;qCAAM;oCAAE,sBAAsB;gCAAM;4BACnJ;4BACA,WAAW;gCACT,MAAM;gCACN,YAAY;oCACV,MAAM;wCAAE,MAAM;oCAAS;oCACvB,OAAO;wCAAE,MAAM;wCAAS,OAAO;4CAAE,MAAM;wCAAS;oCAAE;oCAClD,cAAc;wCAAE,MAAM;oCAAS;oCAC/B,eAAe;wCAAE,MAAM;oCAAS;gCAClC;gCACA,UAAU;oCAAC;oCAAQ;oCAAgB;iCAAgB;gCACnD,sBAAsB;4BACxB;4BACA,QAAQ;gCACN,MAAM;gCACN,OAAO;oCACL,MAAM;oCACN,YAAY;wCACV,MAAM;4CAAE,MAAM;wCAAS;wCACvB,SAAS;4CAAE,MAAM;wCAAS;wCAC1B,YAAY;4CAAE,MAAM;4CAAS,OAAO;gDAAE,MAAM;4CAAS;4CAAG,UAAU;4CAAG,UAAU;wCAAE;wCACjF,QAAQ;4CAAE,MAAM;wCAAS;wCACzB,UAAU;4CAAE,MAAM;wCAAS;wCAC3B,SAAS;4CAAE,MAAM;wCAAU;wCAC3B,UAAU;4CAAE,MAAM;4CAAU,YAAY;gDAAE,KAAK;oDAAE,MAAM;gDAAS;gDAAG,KAAK;oDAAE,MAAM;gDAAS;4CAAE;4CAAG,sBAAsB;wCAAM;wCAC1H,SAAS;4CAAE,MAAM;wCAAS;wCAC1B,OAAO;4CAAE,MAAM;wCAAS;wCACxB,eAAe;4CAAE,MAAM;wCAAS;wCAChC,SAAS;4CAAE,MAAM;wCAAS;wCAC1B,MAAM;4CAAE,MAAM;4CAAS,OAAO;gDAAE,MAAM;4CAAS;wCAAE;oCACnD;oCACA,UAAU;wCAAC;wCAAQ;qCAAa;oCAChC,sBAAsB;gCACxB;4BACF;4BACA,SAAS;gCACP,MAAM;gCACN,OAAO;oCACL,MAAM;oCACN,YAAY;wCACV,MAAM;4CAAE,MAAM;wCAAS;wCACvB,MAAM;4CAAE,MAAM;wCAAS;wCACvB,OAAO;4CAAE,MAAM;wCAAS;wCACxB,QAAQ;4CAAE,MAAM;wCAAS;wCACzB,gBAAgB;4CAAE,MAAM;wCAAS;wCACjC,WAAW;4CAAE,MAAM;4CAAS,OAAO;gDAAE,MAAM;4CAAS;wCAAE;wCACtD,UAAU;4CAAE,MAAM;4CAAU,YAAY;gDAAE,KAAK;oDAAE,MAAM;gDAAS;gDAAG,KAAK;oDAAE,MAAM;gDAAS;4CAAE;4CAAG,sBAAsB;wCAAM;wCAC1H,SAAS;4CAAE,MAAM;wCAAS;wCAC1B,OAAO;4CAAE,MAAM;wCAAS;wCACxB,eAAe;4CAAE,MAAM;wCAAS;wCAChC,SAAS;4CAAE,MAAM;wCAAS;wCAC1B,MAAM;4CAAE,MAAM;4CAAS,OAAO;gDAAE,MAAM;4CAAS;wCAAE;wCACjD,OAAO;4CAAE,MAAM;wCAAS;wCACxB,cAAc;4CAAE,MAAM;wCAAS;wCAC/B,eAAe;4CAAE,MAAM;wCAAS;wCAChC,YAAY;4CAAE,MAAM;4CAAS,OAAO;gDAAE,MAAM;4CAAS;wCAAE;oCACzD;oCACA,UAAU;wCAAC;wCAAQ;qCAAQ;oCAC3B,sBAAsB;gCACxB;4BACF;4BACA,aAAa;gCACX,MAAM;gCACN,OAAO;oCACL,MAAM;oCACN,YAAY;wCACV,MAAM;4CAAE,MAAM;wCAAS;wCACvB,QAAQ;4CAAE,OAAO;gDAAC;oDAAE,MAAM;gDAAS;gDAAG;oDAAE,MAAM;gDAAS;6CAAE;wCAAC;wCAC1D,WAAW;4CAAE,MAAM;wCAAS;wCAC5B,MAAM;4CAAE,MAAM;wCAAS;wCACvB,aAAa;4CAAE,MAAM;4CAAS,OAAO;gDAAE,MAAM;4CAAS;wCAAE;wCACxD,SAAS;4CAAE,MAAM;wCAAS;wCAC1B,eAAe;4CAAE,MAAM;wCAAS;wCAChC,SAAS;4CAAE,MAAM;wCAAS;wCAC1B,MAAM;4CAAE,MAAM;4CAAS,OAAO;gDAAE,MAAM;4CAAS;wCAAE;wCACjD,UAAU;4CAAE,MAAM;4CAAU,YAAY;gDAAE,KAAK;oDAAE,MAAM;gDAAS;gDAAG,KAAK;oDAAE,MAAM;gDAAS;4CAAE;4CAAG,sBAAsB;wCAAM;wCAC1H,kBAAkB;4CAAE,MAAM;wCAAS;oCACrC;oCACA,UAAU;wCAAC;wCAAQ;qCAAS;oCAC5B,sBAAsB;gCACxB;4BACF;wBACF;wBACA,UAAU;4BAAC;4BAAQ;yBAAQ;wBAC3B,sBAAsB;oBACxB;gBACF;gBACA,SAAS;oBACP,MAAM;oBACN,OAAO;wBACL,MAAM;wBACN,YAAY;4BACV,UAAU;gCAAE,MAAM;gCAAS,OAAO;oCAAE,MAAM;gCAAS;gCAAG,UAAU;gCAAG,UAAU;4BAAE;4BAC/E,OAAO;gCAAE,MAAM;4BAAS;wBAC1B;wBACA,UAAU;4BAAC;yBAAW;wBACtB,sBAAsB;oBACxB;gBACF;YACF;YACA,UAAU;gBAAC;gBAAe;gBAAc;gBAAY;aAAO;YAC3D,sBAAsB;QACxB;QACA,MAAM,MAAM,CAAC,0EAA0E,EAAE,KAAK,SAAS,CACrG,eACA,4QAA4Q,EAAE,WAAW,GAAG,EAAE,SAAS,kDAAkD,EAAE,KAAK,IAAI,EAAE,MAAM,MAAM,CAAC,qMAAqM,EAAE,YAAY,oBAAoB,EAAE,YAAY,yMAAyM,EAAE,UAAU,IAAI,CAAC,QAAQ,IAAI,UAAU,EAAE,MAAM,GAAG,CAAC,CAAC,GAAG,IAAM,IAAA,yKAAe,EAAC,IAAI,IAAI,CAAC,KAAK,UAAU,EAAE,gBAAgB,YAAY,CAAC,QAAQ,EAAE,KAAK,KAAK,CAAC,aAAa,iEAAiE,CAAC,GAAG,CAAC,6CAA6C,CAAC,CAAC,0MAA0M,CAAC;QACzxC,MAAM,OAAO,CAAC,sDAAsD,EAAE,KAAK,SAAS,CAAC,eAAe,+OAA+O,EAAE,WAAW,GAAG,EAAE,SAAS,kFAAkF,EAAE,KAAK,IAAI,EAAE,MAAM,MAAM,CAAC,qRAAqR,EAAE,YAAY,2BAA2B,EAAE,gBAAgB,YAAY,CAAC,KAAK,EAAE,KAAK,KAAK,CAAC,aAAa,8BAA8B,EAAE,KAAK,GAAG,CAAC,GAAG,aAAa,aAAa,EAAE,KAAK,GAAG,CAAC,GAAG,aAAa,KAAK,CAAC,GAAG,CAAC,yCAAyC,CAAC,CAAC,6EAA6E,CAAC;QAC1jC,MAAM,OAAO,CAAC,IAAI,EAAE,YAAY,OAAO,EAAE,WAAW,CAAC,EAAE,SAAS,KAAK,EAAE,KAAK,GAAG,CAAC,GAAG,aAAa,EAAE,EAAE,gBAAgB,YAAY,CAAC,MAAM,EAAE,KAAK,KAAK,CAAC,aAAa,EAAE,CAAC,GAAG,GAAG,MAAM,EAAE,cAC/K,GAAG,CAAC,CAAC,IAAM,GAAG,EAAE,IAAI,CAAC,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC,EACzC,IAAI,CAAC,MAAM;QACd,MAAM,WAAgB;YACpB;YACA,UAAU;gBACR;oBAAE,MAAM;oBAAU,SAAS;gBAAK;gBAChC;oBAAE,MAAM;oBAAQ,SAAS;gBAAK;aAC/B;YACD,aAAa,OAAO,QAAQ,GAAG,CAAC,kBAAkB,IAAI;YACtD,YAAY,OAAO,QAAQ,GAAG,CAAC,iBAAiB,IAAI;QACtD;QACA,IAAI;YACF,MAAM,UAAU,OAAO;gBACrB,MAAM,OACJ,WAAW,WACP;oBAAE,GAAG,QAAQ;oBAAE,iBAAiB;wBAAE,MAAM;wBAAe,aAAa;4BAAE,MAAM;4BAAe,QAAQ;wBAAc;oBAAE;gBAAE,IACrH,WAAW,WACX;oBAAE,GAAG,QAAQ;oBAAE,iBAAiB;wBAAE,MAAM;oBAAc;gBAAE,IACxD;gBACN,MAAM,OAAO,MAAM,MAAM,KAAK;oBAC5B,QAAQ;oBACR,SAAS;wBACP,gBAAgB;wBAChB,eAAe,CAAC,OAAO,EAAE,QAAQ;oBACnC;oBACA,MAAM,KAAK,SAAS,CAAC;gBACvB;gBACA,MAAM,OAAO,MAAM,KAAK,IAAI,GAAG,KAAK,CAAC,IAAM;gBAC3C,OAAO;oBAAE;oBAAM;gBAAK;YACtB;YACA,mEAAmE;YACnE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ;YACnC,IAAI,CAAC,KAAK,EAAE,EAAE;gBACZ,QAAQ,IAAI,CAAC,qDAAqD;oBAAE,QAAQ,KAAK,MAAM;oBAAE,OAAO,MAAM;gBAAM;YAC9G;YACA,yFAAyF;YACzF,IACE,QAAQ,CACN,KAAK,KAAK,EAAE,UAAU,0BACtB,wBAAwB,IAAI,CAAC,OAAO,KAAK,KAAK,EAAE,WAAW,QAC3D,OAAO,KAAK,KAAK,EAAE,SAAS,IAAI,UAAU,CAAC,mBAC7C,GACA;gBACA,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ,SAAS;gBACzC,IAAI,CAAC,KAAK,EAAE,EAAE;oBACZ,QAAQ,IAAI,CAAC,qDAAqD;wBAAE,QAAQ,KAAK,MAAM;wBAAE,OAAO,MAAM;oBAAM;oBAC5G,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ,OAAO;oBACvC,IAAI,CAAC,KAAK,EAAE,EAAE;wBACZ,QAAQ,IAAI,CAAC,mDAAmD;4BAAE,QAAQ,KAAK,MAAM;4BAAE,OAAO,MAAM;wBAAM;oBAC5G;gBACF;YACF;YACA,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM;gBACrB,QAAQ,IAAI,CAAC,kEAAkE;oBAAE,IAAI,KAAK,EAAE;oBAAE,QAAQ,KAAK,MAAM;gBAAC;gBAClH,OAAO;YACT;YACA,MAAM,UAAU,MAAM,SAAS,CAAC,EAAE,EAAE,SAAS,WAAW;YACxD,IAAI,MAAW;YACf,IAAI,OAAO,YAAY,UAAU;gBAC/B,IAAI;oBACF,MAAM,KAAK,KAAK,CAAC;gBACnB,EAAE,OAAM;oBACN,0CAA0C;oBAC1C,IAAI,IAAI;oBACR,IAAI,EAAE,OAAO,CAAC,oBAAoB,IAAI,OAAO,CAAC,QAAQ;oBACtD,MAAM,IAAI,EAAE,KAAK,CAAC;oBAClB,IAAI,GAAG;wBACL,IAAI,YAAY,CAAC,CAAC,EAAE;wBACpB,YAAY,UAAU,OAAO,CAAC,iBAAiB;wBAC/C,IAAI;4BAAE,MAAM,KAAK,KAAK,CAAC;wBAAY,EAAE,OAAM,CAAC;oBAC9C;gBACF;YACF,OAAO;gBACL,MAAM;YACR;YACA,IAAI,CAAC,KAAK;gBACR,QAAQ,IAAI,CAAC,sDAAsD;oBAAE,SAAS,OAAO,YAAY,WAAW,OAAO,SAAS,KAAK,CAAC,GAAG,OAAO,OAAO;gBAAQ;gBAC3J,OAAO;YACT;YACA,MAAM,UAAU,MAAM,OAAO,CAAC,KAAK,QAAQ,IAAI,IAAI,GAAG,EAAE;YACxD,+BAA+B;YAC/B,IAAI,QAAQ,MAAM,IAAI,MAAM,OAAO,CAAC,OAAO,CAAC,EAAE,EAAE,QAAQ;gBACtD,IAAI,OAAO,QAAQ,GAAG,CAAC,CAAC,IAAW,CAAC;wBAClC,MAAM,OAAO,EAAE,IAAI,IAAI,IAAI,KAAK,CAAC,GAAG,OAAO,aAAa,OAAO,CAAC,EAAE;wBAClE,OAAO,CAAC,MAAM,OAAO,CAAC,EAAE,KAAK,IAAI,EAAE,KAAK,GAAG,EAAE,EAAE,GAAG,CAAC,CAAC,IAAS,MAAgB,CAAC;gCAC5E,IAAI,GAAG,OAAO,EAAE,IAAI,IAAI,aAAa,OAAO,CAAC,EAAE,GAAG,CAAC,EAAE,KAAK;gCAC1D,MAAM,OAAO,GAAG,IAAI,IAAI;gCACxB,OAAO,OAAO,GAAG,KAAK,IAAI;gCAC1B,MAAM,GAAG,IAAI,GAAG,OAAO,GAAG,IAAI,IAAI;gCAClC,OACE,GAAG,KAAK,IAAI,OAAO,GAAG,KAAK,KAAK,WAC5B;oCACE,MAAM,OAAO,GAAG,KAAK,CAAC,IAAI,IAAI;oCAC9B,UACE,GAAG,KAAK,CAAC,QAAQ,IAAI,OAAO,GAAG,KAAK,CAAC,QAAQ,KAAK,WAC9C;wCAAE,KAAK,OAAO,GAAG,KAAK,CAAC,QAAQ,CAAC,GAAG;wCAAG,KAAK,OAAO,GAAG,KAAK,CAAC,QAAQ,CAAC,GAAG;oCAAE,IACzE;oCACN,SAAS,GAAG,KAAK,CAAC,OAAO,GAAG,OAAO,GAAG,KAAK,CAAC,OAAO,IAAI;oCACvD,OAAO,GAAG,KAAK,CAAC,KAAK,GAAG,OAAO,GAAG,KAAK,CAAC,KAAK,IAAI;oCACjD,UAAU,GAAG,KAAK,CAAC,QAAQ,GAAG,OAAO,GAAG,KAAK,CAAC,QAAQ,IAAI;gCAC5D,IACA;gCACN,kBAAkB,GAAG,gBAAgB,GAAG,OAAO,GAAG,gBAAgB,IAAI;gCACtE,cAAc,GAAG,YAAY,GAAG,OAAO,GAAG,YAAY,IAAI;4BAC5D,CAAC;wBACD,WAAW,MAAM,OAAO,CAAC,EAAE,SAAS,IAChC,EAAE,SAAS,CACR,GAAG,CAAC,CAAC,IAAW,CAAC;gCAAE,KAAK,OAAO,GAAG;gCAAM,KAAK,OAAO,GAAG;4BAAK,CAAC,GAC7D,MAAM,CAAC,CAAC,IAAW,OAAO,QAAQ,CAAC,EAAE,GAAG,KAAK,OAAO,QAAQ,CAAC,EAAE,GAAG,KACrE;wBACJ,WACE,EAAE,SAAS,IAAI,OAAO,EAAE,SAAS,KAAK,WAClC;4BACE,MAAM,OAAO,EAAE,SAAS,CAAC,IAAI,IAAI;4BACjC,OAAO,MAAM,OAAO,CAAC,EAAE,SAAS,CAAC,KAAK,IAAI,EAAE,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,IAAW,OAAO,MAAM;4BACzF,cAAc,EAAE,SAAS,CAAC,YAAY,GAAG,OAAO,EAAE,SAAS,CAAC,YAAY,IAAI;4BAC5E,eAAe,EAAE,SAAS,CAAC,aAAa,GAAG,OAAO,EAAE,SAAS,CAAC,aAAa,IAAI;wBACjF,IACA;wBACN,QAAQ,MAAM,OAAO,CAAC,EAAE,MAAM,IAC1B,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC,IAAW,CAAC;gCACxB,MAAM,OAAO,GAAG,QAAQ;gCACxB,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;gCAC1C,YAAY,MAAM,OAAO,CAAC,GAAG,eAAe,EAAE,UAAU,CAAC,MAAM,KAAK,IAAI;oCAAC,OAAO,EAAE,UAAU,CAAC,EAAE;oCAAG,OAAO,EAAE,UAAU,CAAC,EAAE;iCAAE,GAAG;gCAC7H,QAAQ,GAAG,SAAS,OAAO,EAAE,MAAM,IAAI;gCACvC,UAAU,GAAG,WAAW,OAAO,EAAE,QAAQ,IAAI;gCAC7C,SAAS,OAAO,GAAG,YAAY,YAAY,EAAE,OAAO,GAAG;gCACvD,UAAU,GAAG,YAAY,OAAO,EAAE,QAAQ,KAAK,WAAW;oCAAE,KAAK,OAAO,EAAE,QAAQ,CAAC,GAAG;oCAAG,KAAK,OAAO,EAAE,QAAQ,CAAC,GAAG;gCAAE,IAAI;gCACzH,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;gCAC1C,OAAO,GAAG,QAAQ,OAAO,EAAE,KAAK,IAAI;gCACpC,eAAe,GAAG,gBAAgB,OAAO,EAAE,aAAa,IAAI;gCAC5D,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;gCAC1C,MAAM,MAAM,OAAO,CAAC,GAAG,QAAQ,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,IAAW,OAAO,MAAM;4BACrE,CAAC,KACD;wBACJ,SAAS,MAAM,OAAO,CAAC,EAAE,OAAO,IAC5B,EAAE,OAAO,CAAC,GAAG,CAAC,CAAC,IAAW,CAAC;gCACzB,MAAM,OAAO,GAAG,QAAQ;gCACxB,MAAM,GAAG,OAAO,OAAO,EAAE,IAAI,IAAI;gCACjC,OAAO,GAAG,QAAQ,OAAO,EAAE,KAAK,IAAI;gCACpC,QAAQ,GAAG,SAAS,OAAO,EAAE,MAAM,IAAI;gCACvC,gBAAgB,GAAG,iBAAiB,OAAO,EAAE,cAAc,IAAI;gCAC/D,WAAW,MAAM,OAAO,CAAC,GAAG,aAAa,EAAE,SAAS,CAAC,GAAG,CAAC,CAAC,IAAW,OAAO,MAAM;gCAClF,UAAU,GAAG,YAAY,OAAO,EAAE,QAAQ,KAAK,WAAW;oCAAE,KAAK,OAAO,EAAE,QAAQ,CAAC,GAAG;oCAAG,KAAK,OAAO,EAAE,QAAQ,CAAC,GAAG;gCAAE,IAAI;gCACzH,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;gCAC1C,OAAO,GAAG,QAAQ,OAAO,EAAE,KAAK,IAAI;gCACpC,eAAe,GAAG,gBAAgB,OAAO,EAAE,aAAa,IAAI;gCAC5D,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;gCAC1C,MAAM,MAAM,OAAO,CAAC,GAAG,QAAQ,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,IAAW,OAAO,MAAM;gCACnE,OAAO,GAAG,QAAQ,OAAO,EAAE,KAAK,IAAI;gCACpC,cAAc,GAAG,eAAe,OAAO,EAAE,YAAY,IAAI;gCACzD,eAAe,GAAG,gBAAgB,OAAO,EAAE,aAAa,IAAI;gCAC5D,YAAY,MAAM,OAAO,CAAC,GAAG,cAAc,EAAE,UAAU,CAAC,GAAG,CAAC,CAAC,KAAY,OAAO,OAAO;4BACzF,CAAC,KACD;wBACJ,aAAa,MAAM,OAAO,CAAC,EAAE,WAAW,IACpC,EAAE,WAAW,CAAC,GAAG,CAAC,CAAC,IAAW,CAAC;gCAC7B,MAAM,OAAO,GAAG,QAAQ;gCACxB,QAAQ,OAAO,GAAG,WAAW,WAAW,EAAE,MAAM,GAAG,GAAG,SAAS,OAAO,EAAE,MAAM,IAAI;gCAClF,WAAW,GAAG,YAAY,OAAO,EAAE,SAAS,IAAI;gCAChD,MAAM,GAAG,OAAO,OAAO,EAAE,IAAI,IAAI;gCACjC,aAAa,MAAM,OAAO,CAAC,GAAG,eAAe,EAAE,WAAW,CAAC,GAAG,CAAC,CAAC,IAAW,OAAO,MAAM;gCACxF,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;gCAC1C,eAAe,GAAG,gBAAgB,OAAO,EAAE,aAAa,IAAI;gCAC5D,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;gCAC1C,MAAM,MAAM,OAAO,CAAC,GAAG,QAAQ,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,IAAW,OAAO,MAAM;gCACnE,UAAU,GAAG,YAAY,OAAO,EAAE,QAAQ,KAAK,WAAW;oCAAE,KAAK,OAAO,EAAE,QAAQ,CAAC,GAAG;oCAAG,KAAK,OAAO,EAAE,QAAQ,CAAC,GAAG;gCAAE,IAAI;gCACzH,kBAAkB,GAAG,mBAAmB,OAAO,EAAE,gBAAgB,IAAI;4BACvE,CAAC,KACD;oBACN,CAAC;gBACD,gCAAgC;gBAChC,MAAM,eAAe;oBACnB;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAM;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAK;oBAAM;oBAAK;oBAAK;oBAAO;oBAAK;oBAAK;oBAAK;oBAAK;iBACzL;gBACD,MAAM,UAAU,aAAa,IAAI,CAAC,CAAC,IAAM,YAAY,QAAQ,CAAC,OAAO;gBACrE,MAAM,oBAAoB,CAAC;oBACzB,IAAI,CAAC,GAAG,OAAO;oBACf,MAAM,UAAU,EAAE,QAAQ,CAAC;oBAC3B,MAAM,QAAQ,aAAa,IAAI,CAAC,CAAC,IAAM,EAAE,QAAQ,CAAC,MAAM,MAAM;oBAC9D,OAAO,CAAC,WAAW;gBACrB;gBACA,MAAM,SAAS,CAAC;oBACd,IAAI,CAAC,cAAc,MAAM,EAAE,OAAO;oBAClC,MAAM,OAAO,cAAc,GAAG,CAAC,CAAC,IAAM,EAAE,GAAG;oBAC3C,MAAM,OAAO,cAAc,GAAG,CAAC,CAAC,IAAM,EAAE,GAAG;oBAC3C,MAAM,SAAS;oBACf,MAAM,SAAS;oBACf,OAAO;wBAAE,QAAQ,KAAK,GAAG,IAAI,QAAQ;wBAAQ,QAAQ,KAAK,GAAG,IAAI,QAAQ;wBAAQ,QAAQ,KAAK,GAAG,IAAI,QAAQ;wBAAQ,QAAQ,KAAK,GAAG,IAAI,QAAQ;oBAAO;gBAC1J,CAAC;gBACD,MAAM,WAAW,CAAC;oBAChB,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,OAAO,QAAQ,CAAC,IAAI,GAAG,KAAM,CAAC,OAAO,QAAQ,CAAC,IAAI,GAAG,GAAI,OAAO;oBACxF,OAAO,IAAI,GAAG,IAAK,OAAO,MAAM,IAAI,IAAI,GAAG,IAAK,OAAO,MAAM,IAAI,IAAI,GAAG,IAAK,OAAO,MAAM,IAAI,IAAI,GAAG,IAAK,OAAO,MAAM;gBACzH;gBACA,MAAM,UAAU,CAAC,MAAe,SAAkB;oBAChD,IAAI,kBAAkB,SAAS,kBAAkB,UAAU,OAAO;oBAClE,IAAI,CAAC,SAAS,MAAM,OAAO;oBAC3B,OAAO;gBACT;gBACA,OAAO,KAAK,GAAG,CAAC,CAAC,IAAW,CAAC;wBAC3B,GAAG,CAAC;wBACJ,OAAO,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC;4BAClB,MAAM,MAAM,GAAG,KAAK,EAAE;4BACtB,MAAM,KAAK,GAAG,KAAK,EAAE,QAAQ,GAAG,KAAK;4BACrC,IAAI,GAAG,KAAK,IAAI,CAAC,QAAQ,IAAI,GAAG,KAAK,EAAE,SAAS,MAAM;gCACpD,8BAA8B;gCAC9B,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,GAAG;gCAC3B,OAAO;oCAAE,GAAG,IAAI;gCAAC;4BACnB;4BACA,OAAO;wBACT;wBACA,QAAQ,MAAM,OAAO,CAAC,EAAE,MAAM,IAAI,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,IAAW,QAAQ,GAAG,MAAM,GAAG,SAAS,GAAG,aAAa,EAAE,MAAM;wBACnH,SAAS,MAAM,OAAO,CAAC,EAAE,OAAO,IAAI,EAAE,OAAO,CAAC,MAAM,CAAC,CAAC,IAAW,QAAQ,GAAG,MAAM,GAAG,SAAS,GAAG,aAAa,EAAE,OAAO;wBACvH,aAAa,MAAM,OAAO,CAAC,EAAE,WAAW,IAAI,EAAE,WAAW,CAAC,MAAM,CAAC,CAAC,IAAW,QAAQ,GAAG,MAAM,GAAG,SAAS,GAAG,aAAa,EAAE,WAAW;oBACzI,CAAC;gBACD,qBAAqB;gBACrB,MAAM,aAAa,MAAM,OAAO,CAAC,KAAK,WAAW,IAAI,OAAO,GAAG,EAAE;gBACjE,MAAM,UAAgC,WACnC,GAAG,CAAC,CAAC;oBACJ,MAAM,MAAM,MAAM,OAAO,CAAC,GAAG,YAAY,EAAE,QAAQ,GAAG;oBACtD,MAAM,MAAM,OAAO,KAAK,CAAC,EAAE;oBAC3B,MAAM,MAAM,OAAO,KAAK,CAAC,EAAE;oBAC3B,IAAI,OAAO,QAAQ,CAAC,QAAQ,OAAO,QAAQ,CAAC,MAAM;wBAChD,OAAO;4BAAE,UAAU;gCAAC;gCAAK;6BAAI;4BAAE,OAAO,GAAG,QAAQ,OAAO,EAAE,KAAK,IAAI;wBAAU;oBAC/E;oBACA,OAAO;gBACT,GACC,MAAM,CAAC;gBACV,OAAO;oBAAE;oBAAM;gBAAQ;YACzB;YACA,uDAAuD;YACvD,MAAM,WAAW,QAAQ,GAAG,CAAC,CAAC,IAAM,aAAa;YACjD,MAAM,OAAO,IAAA,oKAAU,EAAC;gBAAE;gBAAS;gBAAU;gBAAa;YAAK;YAC/D,MAAM,aAAa,MAAM,OAAO,CAAC,KAAK,WAAW,IAAI,OAAO,GAAG,EAAE;YACjE,MAAM,UAAgC,WACnC,GAAG,CAAC,CAAC;gBACJ,MAAM,MAAM,MAAM,OAAO,CAAC,GAAG,YAAY,EAAE,QAAQ,GAAG;gBACtD,MAAM,MAAM,OAAO,KAAK,CAAC,EAAE;gBAC3B,MAAM,MAAM,OAAO,KAAK,CAAC,EAAE;gBAC3B,IAAI,OAAO,QAAQ,CAAC,QAAQ,OAAO,QAAQ,CAAC,MAAM;oBAChD,OAAO;wBAAE,UAAU;4BAAC;4BAAK;yBAAI;wBAAE,OAAO,GAAG,QAAQ,OAAO,EAAE,KAAK,IAAI;oBAAU;gBAC/E;gBACA,OAAO;YACT,GACC,MAAM,CAAC;YACV,OAAO;gBAAE;gBAAM;YAAQ;QACzB,EAAE,OAAM;YACN,OAAO;QACT;IACF;IAEA,yBAAyB;IACzB,mCAAmC;IACnC,eAAe;QACb,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;QACzC,MAAM,QAAQ,QAAQ,GAAG,CAAC,YAAY;QACtC,MAAM,OAAO,QAAQ,GAAG,CAAC,eAAe,IAAI;QAC5C,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,MAAM,OAAO;QACvC,MAAM,MAAM,KAAK,OAAO,CAAC,OAAO,MAAM;QAEtC,MAAM,cAAc,KAAK,GAAG,CAAC,GAAG,OAAO,QAAQ,GAAG,CAAC,mBAAmB,IAAI;QAC1E,MAAM,UAA8B,IAAI,MAAM,QAAQ,MAAM,EAAE,IAAI,CAAC;QACnE,MAAM,aAAyB,IAAI,MAAM,QAAQ,MAAM,EAAE,IAAI,CAAC,EAAE;QAChE,IAAI,MAAM;QAEV,MAAM,SAAS;YACb,MAAO,KAAM;gBACX,MAAM,MAAM;gBACZ,IAAI,OAAO,QAAQ,MAAM,EAAE;gBAC3B,MAAM,IAAI,OAAO,CAAC,IAAI;gBACtB,MAAM,KAAK,aAAa;gBACxB,MAAM,KAAK,aAAa;gBAExB,MAAM,gBAAgB;oBACpB,MAAM;oBACN,YAAY;wBACV,IAAI;4BAAE,MAAM;wBAAS;wBACrB,aAAa;4BAAE,MAAM;wBAAS;wBAC9B,YAAY;4BAAE,MAAM;wBAAS;wBAC7B,UAAU;4BAAE,MAAM;wBAAS;wBAC3B,MAAM;4BAAE,MAAM;4BAAS,OAAO;gCAAE,MAAM;gCAAU,YAAY;oCAAE,MAAM;wCAAE,MAAM;oCAAS;oCAAG,OAAO;wCAAE,MAAM;oCAAQ;gCAAE;gCAAG,UAAU;oCAAC;oCAAQ;iCAAQ;gCAAE,sBAAsB;4BAAM;wBAAE;wBAC/K,SAAS;4BAAE,MAAM;4BAAS,OAAO;gCAAE,MAAM;gCAAU,YAAY;oCAAE,UAAU;wCAAE,MAAM;wCAAS,OAAO;4CAAE,MAAM;wCAAS;wCAAG,UAAU;wCAAG,UAAU;oCAAE;oCAAG,OAAO;wCAAE,MAAM;oCAAS;gCAAE;gCAAG,UAAU;oCAAC;iCAAW;gCAAE,sBAAsB;4BAAM;wBAAE;oBACxO;oBACA,UAAU;wBAAC;wBAAe;wBAAc;wBAAY;qBAAO;oBAC3D,sBAAsB;gBACxB;gBACA,MAAM,OAAO,CAAC,gCAAgC,EAAE,KAAK,SAAS,CAAC,eAAe,IAAI,EAAE,GAAG,GAAG,EAAE,GAAG,mKAAmK,EAAE,YAAY,OAAO,EAAE,gBAAgB,YAAY,CAAC,KAAK,EAAE,KAAK,KAAK,CAAC,aAAa,2BAA2B,EAAE,KAAK,GAAG,CAAC,GAAG,aAAa,KAAK,CAAC,GAAG,CAAC,oCAAoC,CAAC,CAAC,eAAe,CAAC;gBAC3c,MAAM,OAAO,CAAC,IAAI,EAAE,YAAY,OAAO,EAAE,GAAG,CAAC,EAAE,GAAG,KAAK,EAAE,KAAK,GAAG,CAAC,GAAG,aAAa,QAAQ,EAAE,cAAc,GAAG,CAAC,CAAC,IAAM,GAAG,EAAE,IAAI,CAAC,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM;gBAChK,MAAM,WAAgB;oBACpB;oBACA,UAAU;wBACR;4BAAE,MAAM;4BAAU,SAAS;wBAAK;wBAChC;4BAAE,MAAM;4BAAQ,SAAS;wBAAK;qBAC/B;oBACD,aAAa,OAAO,QAAQ,GAAG,CAAC,kBAAkB,IAAI;oBACtD,8BAA8B;oBAC9B,YAAY,KAAK,GAAG,CAAC,OAAO,QAAQ,GAAG,CAAC,iBAAiB,IAAI,OAAO;gBACtE;gBACA,MAAM,UAAU,OAAO;oBACrB,MAAM,OACJ,WAAW,WACP;wBAAE,GAAG,QAAQ;wBAAE,iBAAiB;4BAAE,MAAM;4BAAe,aAAa;gCAAE,MAAM;gCAAe,QAAQ;4BAAc;wBAAE;oBAAE,IACrH,WAAW,WACX;wBAAE,GAAG,QAAQ;wBAAE,iBAAiB;4BAAE,MAAM;wBAAc;oBAAE,IACxD;oBACN,MAAM,OAAO,MAAM,MAAM,KAAK;wBAAE,QAAQ;wBAAQ,SAAS;4BAAE,gBAAgB;4BAAoB,eAAe,CAAC,OAAO,EAAE,QAAQ;wBAAC;wBAAG,MAAM,KAAK,SAAS,CAAC;oBAAM;oBAC/J,MAAM,OAAO,MAAM,KAAK,IAAI,GAAG,KAAK,CAAC,IAAM;oBAC3C,OAAO;wBAAE;wBAAM;oBAAK;gBACtB;gBACA,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ;gBACnC,IAAI,CAAC,KAAK,EAAE,EAAE;oBACZ,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ,SAAS;oBACzC,IAAI,CAAC,KAAK,EAAE,EAAE;wBACZ,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ,OAAO;oBACzC;gBACF;gBACA,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM;oBACrB,OAAO,CAAC,IAAI,GAAG;oBACf,UAAU,CAAC,IAAI,GAAG,EAAE;oBACpB;gBACF;gBACA,MAAM,UAAU,MAAM,SAAS,CAAC,EAAE,EAAE,SAAS,WAAW;gBACxD,IAAI,MAAW;gBACf,IAAI,OAAO,YAAY,UAAU;oBAC/B,IAAI;wBAAE,MAAM,KAAK,KAAK,CAAC;oBAAU,EAAE,OAAM;wBACvC,IAAI,IAAI;wBAAS,IAAI,EAAE,OAAO,CAAC,oBAAoB,IAAI,OAAO,CAAC,QAAQ;wBACvE,MAAM,IAAI,EAAE,KAAK,CAAC;wBAAgB,IAAI,GAAG;4BAAE,IAAI,YAAY,CAAC,CAAC,EAAE;4BAAE,YAAY,UAAU,OAAO,CAAC,iBAAiB;4BAAO,IAAI;gCAAE,MAAM,KAAK,KAAK,CAAC;4BAAY,EAAE,OAAM,CAAC;wBACnK;oBACF;gBACF,OAAO;oBAAE,MAAM;gBAAS;gBACxB,MAAM,UAAU,MAAM,OAAO,CAAC,KAAK,QAAQ,IAAI,IAAI,GAAG,EAAE;gBACxD,IAAI,QAAQ,MAAM,IAAI,MAAM,OAAO,CAAC,OAAO,CAAC,EAAE,EAAE,QAAQ;oBACtD,MAAM,SAAS,OAAO,CAAC,EAAE;oBACzB,MAAM,SAAkB;wBACtB,MAAM,OAAO,OAAO,IAAI,IAAI,IAAI,KAAK,CAAC,GAAG,OAAO;wBAChD,OAAO,CAAC,MAAM,OAAO,CAAC,OAAO,KAAK,IAAI,OAAO,KAAK,GAAG,EAAE,EAAE,GAAG,CAAC,CAAC,IAAS,OAAiB,CAAC;gCACvF,IAAI,GAAG,GAAG,CAAC,EAAE,MAAM;gCACnB,MAAM,OAAO,GAAG,IAAI,IAAI;gCACxB,OAAO,OAAO,GAAG,KAAK,IAAI;gCAC1B,MAAM,GAAG,IAAI,GAAG,OAAO,GAAG,IAAI,IAAI;gCAClC,OAAO,GAAG,KAAK,IAAI,OAAO,GAAG,KAAK,KAAK,WAAW;oCAAE,MAAM,OAAO,GAAG,KAAK,CAAC,IAAI,IAAI;oCAAK,UAAU,GAAG,KAAK,CAAC,QAAQ,IAAI,OAAO,GAAG,KAAK,CAAC,QAAQ,KAAK,WAAW;wCAAE,KAAK,OAAO,GAAG,KAAK,CAAC,QAAQ,CAAC,GAAG;wCAAG,KAAK,OAAO,GAAG,KAAK,CAAC,QAAQ,CAAC,GAAG;oCAAE,IAAI;oCAAW,SAAS,GAAG,KAAK,CAAC,OAAO,GAAG,OAAO,GAAG,KAAK,CAAC,OAAO,IAAI;oCAAW,OAAO,GAAG,KAAK,CAAC,KAAK,GAAG,OAAO,GAAG,KAAK,CAAC,KAAK,IAAI;oCAAW,UAAU,GAAG,KAAK,CAAC,QAAQ,GAAG,OAAO,GAAG,KAAK,CAAC,QAAQ,IAAI;gCAAU,IAAI;gCAC5b,kBAAkB,GAAG,gBAAgB,GAAG,OAAO,GAAG,gBAAgB,IAAI;gCACtE,cAAc,GAAG,YAAY,GAAG,OAAO,GAAG,YAAY,IAAI;4BAC5D,CAAC;wBACD,WAAW,MAAM,OAAO,CAAC,OAAO,SAAS,IAAI,OAAO,SAAS,CAAC,GAAG,CAAC,CAAC,IAAW,CAAC;gCAAE,KAAK,OAAO,GAAG;gCAAM,KAAK,OAAO,GAAG;4BAAK,CAAC,GAAG,MAAM,CAAC,CAAC,IAAW,OAAO,QAAQ,CAAC,EAAE,GAAG,KAAK,OAAO,QAAQ,CAAC,EAAE,GAAG,KAAK;wBACrM,WAAW,OAAO,SAAS,IAAI,OAAO,OAAO,SAAS,KAAK,WAAW;4BAAE,MAAM,OAAO,OAAO,SAAS,CAAC,IAAI,IAAI;4BAAY,OAAO,MAAM,OAAO,CAAC,OAAO,SAAS,CAAC,KAAK,IAAI,OAAO,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,IAAW,OAAO,MAAM;4BAAW,cAAc,OAAO,SAAS,CAAC,YAAY,GAAG,OAAO,OAAO,SAAS,CAAC,YAAY,IAAI;4BAAW,eAAe,OAAO,SAAS,CAAC,aAAa,GAAG,OAAO,OAAO,SAAS,CAAC,aAAa,IAAI;wBAAU,IAAI;wBAChb,QAAQ,MAAM,OAAO,CAAC,OAAO,MAAM,IAAI,OAAO,MAAM,CAAC,GAAG,CAAC,CAAC,IAAW,CAAC;gCAAE,MAAM,OAAO,GAAG,QAAQ;gCAAO,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;gCAAW,YAAY,MAAM,OAAO,CAAC,GAAG,eAAe,EAAE,UAAU,CAAC,MAAM,KAAK,IAAI;oCAAC,OAAO,EAAE,UAAU,CAAC,EAAE;oCAAG,OAAO,EAAE,UAAU,CAAC,EAAE;iCAAE,GAAG;gCAAW,QAAQ,GAAG,SAAS,OAAO,EAAE,MAAM,IAAI;gCAAW,UAAU,GAAG,WAAW,OAAO,EAAE,QAAQ,IAAI;gCAAW,SAAS,OAAO,GAAG,YAAY,YAAY,EAAE,OAAO,GAAG;gCAAW,UAAU,GAAG,YAAY,OAAO,EAAE,QAAQ,KAAK,WAAW;oCAAE,KAAK,OAAO,EAAE,QAAQ,CAAC,GAAG;oCAAG,KAAK,OAAO,EAAE,QAAQ,CAAC,GAAG;gCAAE,IAAI;gCAAW,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;gCAAW,OAAO,GAAG,QAAQ,OAAO,EAAE,KAAK,IAAI;gCAAW,eAAe,GAAG,gBAAgB,OAAO,EAAE,aAAa,IAAI;gCAAW,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;gCAAW,MAAM,MAAM,OAAO,CAAC,GAAG,QAAQ,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,IAAW,OAAO,MAAM;4BAAU,CAAC,KAAK;wBACv4B,SAAS,MAAM,OAAO,CAAC,OAAO,OAAO,IAAI,OAAO,OAAO,CAAC,GAAG,CAAC,CAAC,IAAW,CAAC;gCAAE,MAAM,OAAO,GAAG,QAAQ;gCAAO,MAAM,GAAG,OAAO,OAAO,EAAE,IAAI,IAAI;gCAAW,OAAO,GAAG,QAAQ,OAAO,EAAE,KAAK,IAAI;gCAAW,QAAQ,GAAG,SAAS,OAAO,EAAE,MAAM,IAAI;gCAAW,gBAAgB,GAAG,iBAAiB,OAAO,EAAE,cAAc,IAAI;gCAAW,WAAW,MAAM,OAAO,CAAC,GAAG,aAAa,EAAE,SAAS,CAAC,GAAG,CAAC,CAAC,IAAW,OAAO,MAAM;gCAAW,UAAU,GAAG,YAAY,OAAO,EAAE,QAAQ,KAAK,WAAW;oCAAE,KAAK,OAAO,EAAE,QAAQ,CAAC,GAAG;oCAAG,KAAK,OAAO,EAAE,QAAQ,CAAC,GAAG;gCAAE,IAAI;gCAAW,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;gCAAW,OAAO,GAAG,QAAQ,OAAO,EAAE,KAAK,IAAI;gCAAW,eAAe,GAAG,gBAAgB,OAAO,EAAE,aAAa,IAAI;gCAAW,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;gCAAW,MAAM,MAAM,OAAO,CAAC,GAAG,QAAQ,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,IAAW,OAAO,MAAM;gCAAW,OAAO,GAAG,QAAQ,OAAO,EAAE,KAAK,IAAI;gCAAW,cAAc,GAAG,eAAe,OAAO,EAAE,YAAY,IAAI;gCAAW,eAAe,GAAG,gBAAgB,OAAO,EAAE,aAAa,IAAI;gCAAW,YAAY,MAAM,OAAO,CAAC,GAAG,cAAc,EAAE,UAAU,CAAC,GAAG,CAAC,CAAC,KAAY,OAAO,OAAO;4BAAU,CAAC,KAAK;wBACjnC,aAAa,MAAM,OAAO,CAAC,OAAO,WAAW,IAAI,OAAO,WAAW,CAAC,GAAG,CAAC,CAAC,IAAW,CAAC;gCAAE,MAAM,OAAO,GAAG,QAAQ;gCAAO,QAAQ,OAAO,GAAG,WAAW,WAAW,EAAE,MAAM,GAAG,GAAG,SAAS,OAAO,EAAE,MAAM,IAAI;gCAAW,WAAW,GAAG,YAAY,OAAO,EAAE,SAAS,IAAI;gCAAW,MAAM,GAAG,OAAO,OAAO,EAAE,IAAI,IAAI;gCAAW,aAAa,MAAM,OAAO,CAAC,GAAG,eAAe,EAAE,WAAW,CAAC,GAAG,CAAC,CAAC,IAAW,OAAO,MAAM;gCAAW,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;gCAAW,eAAe,GAAG,gBAAgB,OAAO,EAAE,aAAa,IAAI;gCAAW,SAAS,GAAG,UAAU,OAAO,EAAE,OAAO,IAAI;gCAAW,MAAM,MAAM,OAAO,CAAC,GAAG,QAAQ,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,IAAW,OAAO,MAAM;gCAAW,UAAU,GAAG,YAAY,OAAO,EAAE,QAAQ,KAAK,WAAW;oCAAE,KAAK,OAAO,EAAE,QAAQ,CAAC,GAAG;oCAAG,KAAK,OAAO,EAAE,QAAQ,CAAC,GAAG;gCAAE,IAAI;gCAAW,kBAAkB,GAAG,mBAAmB,OAAO,EAAE,gBAAgB,IAAI;4BAAU,CAAC,KAAK;oBACv3B;oBACA,OAAO,CAAC,IAAI,GAAG;oBACf,MAAM,aAAa,MAAM,OAAO,CAAC,KAAK,WAAW,IAAI,OAAO,GAAG,EAAE;oBACjE,MAAM,UAAoB,WAAW,GAAG,CAAC,CAAC;wBAAa,MAAM,OAAO,MAAM,OAAO,CAAC,GAAG,YAAY,EAAE,QAAQ,GAAG;wBAAM,MAAM,MAAM,OAAO,MAAM,CAAC,EAAE;wBAAG,MAAM,MAAM,OAAO,MAAM,CAAC,EAAE;wBAAG,IAAI,OAAO,QAAQ,CAAC,QAAQ,OAAO,QAAQ,CAAC,MAAM;4BAAE,OAAO;gCAAE,UAAU;oCAAC;oCAAK;iCAAI;gCAAE,OAAO,GAAG,QAAQ,OAAO,EAAE,KAAK,IAAI;4BAAU;wBAAa;wBAAE,OAAO;oBAAM,GAAG,MAAM,CAAC;oBACzV,UAAU,CAAC,IAAI,GAAG;gBACpB,OAAO;oBACL,OAAO,CAAC,IAAI,GAAG;oBACf,UAAU,CAAC,IAAI,GAAG,EAAE;gBACtB;YACF;QACF;QAEA,MAAM,QAAQ,GAAG,CAAC,MAAM,IAAI,CAAC;YAAE,QAAQ;QAAY,GAAG,IAAM;QAC5D,IAAI,QAAQ,KAAK,CAAC,CAAC,IAAM,MAAM,OAAO;YACpC,MAAM,OAAO,QAAQ,MAAM,CAAC;YAC5B,MAAM,SAAmB,EAAE;YAC3B,MAAM,OAAO,IAAI;YACjB,KAAK,MAAM,OAAO,WAAY;gBAC5B,KAAK,MAAM,KAAK,IAAK;oBACnB,MAAM,IAAI,GAAG,EAAE,QAAQ,CAAC,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,EAAE,QAAQ,CAAC,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,EAAE,KAAK,IAAI,IAAI;oBACpF,IAAI,KAAK,GAAG,CAAC,IAAI;oBAAU,KAAK,GAAG,CAAC;oBAAI,OAAO,IAAI,CAAC;gBACtD;YACF;YACA,OAAO;gBAAE;gBAAM,SAAS;YAAO;QACjC;QACA,OAAO;IACT;IAEA,IAAI,YAAY,MAAM;IACtB,IAAI,OAAyB,WAAW,QAAQ;IAChD,IAAI,SAA6B,OAAO,QAAQ;IAChD,+BAA+B;IAC/B,IAAI,CAAC,QAAQ,QAAQ,MAAM,GAAG,GAAG;QAC/B,MAAM,SAAS,MAAM;QACrB,IAAI,QAAQ,MAAM,QAAQ;YACxB,OAAO,OAAO,IAAI;YAClB,YAAY;YACZ,SAAS;QACX;IACF;IACA,IAAI,CAAC,MAAM;QACT,SAAS;QACT,OAAO,QAAQ,GAAG,CAAC,CAAC,GAAG;YACrB,MAAM,UAAU,aAAa;YAC7B,MAAM,OAAO,CAAC,IAAc,aAAa,CAAC,IAAI,CAAC,cAAc,MAAM,IAAI,CAAC,EAAE;YAC1E,MAAM,QAAoB,MAAM,GAAG,CAAC,CAAC,MAAM;gBACzC,MAAM,MAAM,KAAK,IAAI,IAAI;gBACzB,OAAO;oBACL,IAAI,GAAG,QAAQ,CAAC,EAAE,KAAK;oBACvB,MAAM,IAAA,yKAAe,EAAC;oBACtB,OAAO,GAAG,IAAI,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;oBACnC,MAAM,QAAQ,IAAI,qBAAqB,QAAQ,IAAI,gBAAgB;oBACnE,OAAO;wBAAE,MAAM,IAAI,IAAI;wBAAE,UAAU;4BAAE,KAAK,IAAI,GAAG;4BAAE,KAAK,IAAI,GAAG;wBAAC;oBAAE;oBAClE,kBAAkB;oBAClB,cAAc,QAAQ,IAAI,KAAK,QAAQ,IAAI,KAAK;gBAClD;YACF;YACA,MAAM,UAAU,YAAY,IAAI,CAAC;YACjC,MAAM,aAAa,eAAe,IAAI,CAAC;YACvC,MAAM,SAAS,UACX;gBACE;oBAAE,MAAM;oBAAa,SAAS;oBAAQ,YAAY;wBAAC;wBAAI;qBAAG;oBAAE,QAAQ;oBAAK,UAAU,aAAa,CAAC,EAAE,GAAG;wBAAE,KAAK,aAAa,CAAC,EAAE,CAAC,GAAG;wBAAE,KAAK,aAAa,CAAC,EAAE,CAAC,GAAG;oBAAC,IAAI;oBAAW,SAAS;oBAAU,OAAO;oBAAW,eAAe;oBAAe,MAAM;wBAAC;wBAAM;qBAAM;gBAAC;gBACnQ;oBAAE,MAAM;oBAAgB,SAAS;oBAAS,YAAY;wBAAC;wBAAI;qBAAG;oBAAE,QAAQ;oBAAK,UAAU,aAAa,CAAC,EAAE,GAAG;wBAAE,KAAK,aAAa,CAAC,EAAE,CAAC,GAAG;wBAAE,KAAK,aAAa,CAAC,EAAE,CAAC,GAAG;oBAAC,IAAI;oBAAW,SAAS;oBAAQ,OAAO;oBAAW,eAAe;oBAAe,MAAM;wBAAC;wBAAK;qBAAM;gBAAC;gBACpQ;oBAAE,MAAM;oBAAc,SAAS;oBAAM,YAAY;wBAAC;wBAAI;qBAAG;oBAAE,QAAQ;oBAAK,UAAU,aAAa,CAAC,EAAE,GAAG;wBAAE,KAAK,aAAa,CAAC,EAAE,CAAC,GAAG;wBAAE,KAAK,aAAa,CAAC,EAAE,CAAC,GAAG;oBAAC,IAAI;oBAAW,SAAS;oBAAU,eAAe;oBAAe,MAAM;wBAAC;qBAAM;gBAAC;aAC3O,GACD,aACA;gBACE;oBAAE,MAAM;oBAAY,SAAS;oBAAO,YAAY;wBAAC;wBAAI;qBAAI;oBAAE,QAAQ;oBAAK,UAAU,aAAa,CAAC,EAAE,GAAG;wBAAE,KAAK,aAAa,CAAC,EAAE,CAAC,GAAG;wBAAE,KAAK,aAAa,CAAC,EAAE,CAAC,GAAG;oBAAC,IAAI;oBAAW,SAAS;oBAAe,OAAO;oBAAY,eAAe;oBAAe,MAAM;wBAAC;wBAAM;qBAAK;gBAAC;gBACvQ;oBAAE,MAAM;oBAAa,SAAS;oBAAO,YAAY;wBAAC;wBAAI;qBAAI;oBAAE,QAAQ;oBAAK,UAAU,aAAa,CAAC,EAAE,GAAG;wBAAE,KAAK,aAAa,CAAC,EAAE,CAAC,GAAG;wBAAE,KAAK,aAAa,CAAC,EAAE,CAAC,GAAG;oBAAC,IAAI;oBAAW,SAAS;oBAAY,OAAO;oBAAY,eAAe;oBAAe,MAAM;wBAAC;wBAAK;qBAAK;gBAAC;gBACpQ;oBAAE,MAAM;oBAAW,SAAS;oBAAM,YAAY;wBAAC;wBAAI;qBAAG;oBAAE,QAAQ;oBAAK,UAAU,aAAa,CAAC,EAAE,GAAG;wBAAE,KAAK,aAAa,CAAC,EAAE,CAAC,GAAG;wBAAE,KAAK,aAAa,CAAC,EAAE,CAAC,GAAG;oBAAC,IAAI;oBAAW,SAAS;oBAAU,eAAe;oBAAe,MAAM;wBAAC;wBAAK;qBAAM;gBAAC;aAC7O,GACD;gBACE;oBAAE,MAAM,GAAG,YAAY,OAAO,CAAC;oBAAE,SAAS;oBAAO,YAAY;wBAAC;wBAAI;qBAAI;oBAAE,QAAQ;oBAAK,UAAU,aAAa,CAAC,EAAE,GAAG;wBAAE,KAAK,aAAa,CAAC,EAAE,CAAC,GAAG;wBAAE,KAAK,aAAa,CAAC,EAAE,CAAC,GAAG;oBAAC,IAAI;oBAAW,MAAM;wBAAC;qBAAK;gBAAC;gBACrM;oBAAE,MAAM,GAAG,YAAY,MAAM,CAAC;oBAAE,SAAS;oBAAM,YAAY;wBAAC;wBAAI;qBAAG;oBAAE,QAAQ;oBAAK,UAAU,aAAa,CAAC,EAAE,GAAG;wBAAE,KAAK,aAAa,CAAC,EAAE,CAAC,GAAG;wBAAE,KAAK,aAAa,CAAC,EAAE,CAAC,GAAG;oBAAC,IAAI;oBAAW,MAAM;wBAAC;qBAAM;gBAAC;gBACnM;oBAAE,MAAM,GAAG,YAAY,OAAO,CAAC;oBAAE,SAAS;oBAAO,YAAY;wBAAC;wBAAI;qBAAI;oBAAE,QAAQ;oBAAK,UAAU,aAAa,CAAC,EAAE,GAAG;wBAAE,KAAK,aAAa,CAAC,EAAE,CAAC,GAAG;wBAAE,KAAK,aAAa,CAAC,EAAE,CAAC,GAAG;oBAAC,IAAI;oBAAW,MAAM;wBAAC;qBAAO;gBAAC;aACxM;YACL,MAAM,cAAc,UAAU,YAAY,aAAa,UAAU;YACjE,MAAM,UAAU;gBAAC;oBAAE,MAAM,GAAG,YAAY,OAAO,EAAE,IAAI,GAAG;oBAAE,MAAM;oBAAa,OAAO;oBAAK,QAAQ;oBAAK,WAAW;wBAAC;wBAAO;wBAAK;qBAAK;oBAAE,OAAO;oBAAG,cAAc;oBAAS,eAAe;oBAAS,UAAU,aAAa,CAAC,IAAI,CAAC,cAAc,MAAM,IAAI,CAAC,EAAE,GAAG;wBAAE,KAAK,aAAa,CAAC,IAAI,CAAC,cAAc,MAAM,IAAI,CAAC,EAAE,CAAC,GAAG;wBAAE,KAAK,aAAa,CAAC,IAAI,CAAC,cAAc,MAAM,IAAI,CAAC,EAAE,CAAC,GAAG;oBAAC,IAAI;gBAAU;aAAE;YAC5X,MAAM,YAAY;gBAAE,MAAM;gBAAW,OAAO;oBAAC;oBAAW;iBAAW;gBAAE,cAAc;gBAAI,eAAe;YAAG;YACzG,MAAM,QAAQ,CAAC,IAAc,aAAa,CAAC,IAAI,CAAC,cAAc,MAAM,IAAI,CAAC,EAAE;YAC3E,MAAM,cAAc;gBAClB;oBAAE,MAAM,GAAG,MAAM,IAAI,GAAG,IAAI,IAAI,YAAY,GAAG,CAAC;oBAAE,QAAQ;oBAAI,WAAW;oBAAM,MAAM;oBAAa,aAAa;wBAAC;wBAAO;qBAAM;oBAAE,UAAU;wBAAE,KAAK,MAAM,IAAI,GAAG,GAAG;wBAAE,KAAK,MAAM,IAAI,GAAG,GAAG;oBAAC;gBAAE;gBAC1L;oBAAE,MAAM,GAAG,MAAM,IAAI,IAAI,GAAG,IAAI,IAAI,YAAY,GAAG,CAAC;oBAAE,QAAQ;oBAAI,WAAW;oBAAM,MAAM;oBAAW,aAAa;wBAAC;wBAAM;qBAAK;oBAAE,UAAU;wBAAE,KAAK,MAAM,IAAI,IAAI,GAAG,GAAG;wBAAE,KAAK,MAAM,IAAI,IAAI,GAAG,GAAG;oBAAC;gBAAE;aACnM;YACD,MAAM,YAAY,cAAc,MAAM,IAAI,IACtC;gBACE;oBAAE,KAAK,KAAK,GAAG,GAAG;oBAAE,KAAK,KAAK,GAAG,GAAG;gBAAC;gBACrC;oBAAE,KAAK,KAAK,GAAG,GAAG;oBAAE,KAAK,KAAK,GAAG,GAAG;gBAAC;aACtC,GACD;YACJ,OAAO;gBAAE,MAAM;gBAAS;gBAAO;gBAAQ;gBAAS;gBAAW;gBAAa;YAAU;QACpF;IACF;IAEA,MAAM,UAAW,WAAW,WAAW,UAAU,OAAO,CAAC,MAAM,GAAG,UAAU,OAAO,GAAI,iBAAiB,MAAM,GAAG,mBAAmB,MAAM,gBAAgB;IAE1J,8EAA8E;IAC9E,IAAI,QAAQ,OAAO,gBAAgB,UAAU;QAC3C,MAAM,EAAE,MAAM,EAAE,GAAG,qBAAqB,MAAM;QAC9C,MAAM,OAAO,KAAK,GAAG,CAAC,OAAO,KAAK,GAAG;QACrC,IAAI,OAAO,MAAM;YACf,MAAM,UAAU,MAAM,mBAAmB;gBAAE,cAAc;gBAAM;gBAAa;gBAAY;gBAAU;gBAAa;YAAY;YAC3H,IAAI,WAAW,QAAQ,MAAM,EAAE;gBAC7B,MAAM,EAAE,QAAQ,SAAS,EAAE,GAAG,qBAAqB,SAAS;gBAC5D,MAAM,UAAU,KAAK,GAAG,CAAC,UAAU,KAAK,GAAG;gBAC3C,IAAI,WAAW,MAAM;oBACnB,OAAO;gBACT;YACF;QACF;IACF;IAEA,oFAAoF;IACpF,IAAI,MAAM,OAAO,CAAC,OAAO;QACvB,OAAO,KAAK,GAAG,CAAC,CAAC;YACf,MAAM,WAAW,MAAM,OAAO,CAAC,EAAE,MAAM,IAAI,EAAE,MAAM,CAAC,KAAK,CAAC,GAAG,KAAK,EAAE;YACpE,IAAI,SAAS,MAAM,IAAI,GAAG,OAAO;YACjC,MAAM,eAAiE;gBACrE;oBAAE,MAAM,GAAG,YAAY,KAAK,CAAC;oBAAE,YAAY;wBAAC;wBAAI;qBAAG;gBAAqB;gBACxE;oBAAE,MAAM,GAAG,YAAY,KAAK,CAAC;oBAAE,YAAY;wBAAC;wBAAI;qBAAG;gBAAqB;gBACxE;oBAAE,MAAM,GAAG,YAAY,KAAK,CAAC;oBAAE,YAAY;wBAAC;wBAAI;qBAAI;gBAAqB;aAC1E;YACD,MAAM,SAAS;mBAAI;aAAS;YAC5B,IAAK,IAAI,IAAI,SAAS,MAAM,EAAE,IAAI,GAAG,IAAK,OAAO,IAAI,CAAC,YAAY,CAAC,EAAE;YACrE,OAAO;gBAAE,GAAG,CAAC;gBAAE,QAAQ;YAAO;QAChC;IACF;IAEA,MAAM,OAAO;QACX,IAAI,CAAC,UAAU,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG,IAAI;QACzD;QACA;QACA;QACA,MAAM;QACN;QACA;IACF;IAEA,8EAA8E;IAC9E,MAAM,YAAY,wKAAc,CAAC,SAAS,CAAC;IAC3C,IAAI,CAAC,UAAU,OAAO,EAAE;QACtB,wCAAwC;QACxC,MAAM,WAAW,QAAQ,GAAG,CAAC,CAAC,IAAM,aAAa;QACjD,MAAM,eAAe,IAAA,oKAAU,EAAC;YAAE,SAAS,KAAK,IAAI;YAAE;YAAU;YAAa;QAAK;QAClF,MAAM,WAAW;YAAE,GAAG,IAAI;YAAE,MAAM;QAAa;QAC/C,MAAM,WAAW,wKAAc,CAAC,SAAS,CAAC;QAC1C,IAAI,CAAC,SAAS,OAAO,EAAE;YACrB,OAAO,uKAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;gBAAqB,QAAQ,SAAS,KAAK,CAAC,MAAM;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACxG;QACA,OAAO,uKAAY,CAAC,IAAI,CAAC;IAC3B;IACA,OAAO,uKAAY,CAAC,IAAI,CAAC,UAAU,IAAI;AACzC","debugId":null}}]
}