{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///Users/lujinlei/Documents/code/AI-Travel-Homework/AI-Travel/web/src/app/api/map/route/route.ts"],"sourcesContent":["function parsePoint(s?: string): [number, number] | null {\n  if (!s) return null;\n  const parts = s.split(\",\").map((v) => Number(v));\n  if (parts.length !== 2 || parts.some((n) => Number.isNaN(n))) return null;\n  return [parts[0], parts[1]]; // [lng, lat]\n}\n\nexport async function GET(req: Request) {\n  const { searchParams } = new URL(req.url);\n  const originStr = searchParams.get(\"origin\") || \"\";\n  const destinationStr = searchParams.get(\"destination\") || \"\";\n  const type = searchParams.get(\"type\") || \"driving\";\n\n  const key = process.env.AMAP_WEBSERVICE_KEY;\n  if (!key) {\n    return new Response(JSON.stringify({ error: \"AMAP_WEBSERVICE_KEY not configured\" }), { status: 500 });\n  }\n\n  const origin = parsePoint(originStr);\n  const destination = parsePoint(destinationStr);\n  if (!origin || !destination) {\n    return new Response(JSON.stringify({ error: \"origin/destination must be 'lng,lat'\" }), { status: 400 });\n  }\n\n  const originParam = `${origin[0]},${origin[1]}`;\n  const destinationParam = `${destination[0]},${destination[1]}`;\n\n  // 选择对应的路径服务端点\n  const endpoint = type === \"walking\"\n    ? \"https://restapi.amap.com/v3/direction/walking\"\n    : type === \"bicycling\"\n    ? \"https://restapi.amap.com/v4/direction/bicycling\"\n    : \"https://restapi.amap.com/v3/direction/driving\";\n\n  const params = new URLSearchParams({ key, origin: originParam, destination: destinationParam });\n  const url = `${endpoint}?${params.toString()}`;\n  const resp = await fetch(url);\n  if (!resp.ok) {\n    return new Response(JSON.stringify({ error: `amap http ${resp.status}` }), { status: 502 });\n  }\n  const data = await resp.json();\n\n  // 解析返回数据，统一为 polyline、distance（米）、duration（秒）\n  let polyline: [number, number][] = [];\n  let distance = 0;\n  let duration = 0;\n\n  if (type === \"walking\") {\n    const route = data?.route;\n    const path = route?.paths?.[0];\n    distance = Number(path?.distance || 0);\n    duration = Number(path?.duration || 0);\n    const steps = path?.steps || [];\n    steps.forEach((s: any) => {\n      const pts = String(s.polyline || \"\").split(\";\").map((p) => p.split(\",\").map(Number));\n      pts.forEach(([lng, lat]: number[]) => {\n        if (!Number.isNaN(lng) && !Number.isNaN(lat)) polyline.push([lng, lat]);\n      });\n    });\n  } else if (type === \"bicycling\") {\n    // v4 返回格式不同，尝试解析 path/steps\n    const dataPaths = data?.data?.paths || [];\n    const path = dataPaths[0];\n    distance = Number(path?.distance || 0);\n    duration = Number(path?.duration || 0);\n    const steps = path?.steps || [];\n    steps.forEach((s: any) => {\n      const pts = String(s.polyline || \"\").split(\";\").map((p) => p.split(\",\").map(Number));\n      pts.forEach(([lng, lat]: number[]) => {\n        if (!Number.isNaN(lng) && !Number.isNaN(lat)) polyline.push([lng, lat]);\n      });\n    });\n  } else {\n    const route = data?.route;\n    const path = route?.paths?.[0];\n    distance = Number(path?.distance || 0);\n    duration = Number(path?.duration || 0);\n    const steps = path?.steps || [];\n    steps.forEach((s: any) => {\n      const pts = String(s.polyline || \"\").split(\";\").map((p) => p.split(\",\").map(Number));\n      pts.forEach(([lng, lat]: number[]) => {\n        if (!Number.isNaN(lng) && !Number.isNaN(lat)) polyline.push([lng, lat]);\n      });\n    });\n  }\n\n  return Response.json({ origin, destination, type, polyline, distance, duration });\n}"],"names":[],"mappings":"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","debugId":null}}]
}