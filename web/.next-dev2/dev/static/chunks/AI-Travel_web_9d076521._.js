(globalThis.TURBOPACK || (globalThis.TURBOPACK = [])).push([typeof document === "object" ? document.currentScript : undefined,
"[project]/AI-Travel/web/src/components/Input.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>__TURBOPACK__default__export__
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI-Travel/web/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI-Travel/web/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
"use client";
;
;
const Input = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["forwardRef"])(_c = ({ label, error, className = "", ...props }, ref)=>{
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("label", {
        className: "block",
        children: [
            label && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                className: "mb-1 block text-sm text-gray-700",
                children: label
            }, void 0, false, {
                fileName: "[project]/AI-Travel/web/src/components/Input.tsx",
                lineNumber: 13,
                columnNumber: 19
            }, ("TURBOPACK compile-time value", void 0)),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("input", {
                ref: ref,
                className: [
                    "w-full rounded-md border px-3 py-2 text-sm shadow-sm",
                    error ? "border-red-400 focus:ring-red-500" : "border-gray-300 focus:ring-indigo-500",
                    "focus:outline-none focus:ring-2",
                    className
                ].join(" "),
                ...props
            }, void 0, false, {
                fileName: "[project]/AI-Travel/web/src/components/Input.tsx",
                lineNumber: 14,
                columnNumber: 9
            }, ("TURBOPACK compile-time value", void 0)),
            error && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                className: "mt-1 block text-xs text-red-600",
                children: error
            }, void 0, false, {
                fileName: "[project]/AI-Travel/web/src/components/Input.tsx",
                lineNumber: 24,
                columnNumber: 19
            }, ("TURBOPACK compile-time value", void 0))
        ]
    }, void 0, true, {
        fileName: "[project]/AI-Travel/web/src/components/Input.tsx",
        lineNumber: 12,
        columnNumber: 7
    }, ("TURBOPACK compile-time value", void 0));
});
_c1 = Input;
Input.displayName = "Input";
const __TURBOPACK__default__export__ = Input;
var _c, _c1;
__turbopack_context__.k.register(_c, "Input$forwardRef");
__turbopack_context__.k.register(_c1, "Input");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/AI-Travel/web/src/components/VoiceButton.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>VoiceButton
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI-Travel/web/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI-Travel/web/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
function VoiceButton({ onTranscribe, className = "" }) {
    _s();
    const [state, setState] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("idle");
    const [message, setMessage] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("");
    const [mode] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("iflytek");
    const streamRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const recRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const chunksRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])([]);
    const wsRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const audioCtxRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const processorRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const textRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])("");
    const tokensRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])([]); // 累积识别词元，支持 wpgs 动态修正
    // 将 Float32 PCM 转为 16bit PCM 并 base64
    const floatTo16kBase64 = (input, inputSampleRate, targetRate = 16000)=>{
        let samples = input;
        if (inputSampleRate !== targetRate) {
            const ratio = inputSampleRate / targetRate;
            const newLength = Math.round(input.length / ratio);
            const resampled = new Float32Array(newLength);
            for(let i = 0; i < newLength; i++){
                const idx = Math.round(i * ratio);
                resampled[i] = input[Math.min(idx, input.length - 1)];
            }
            samples = resampled;
        }
        const buffer = new ArrayBuffer(samples.length * 2);
        const view = new DataView(buffer);
        for(let i = 0; i < samples.length; i++){
            let s = Math.max(-1, Math.min(1, samples[i]));
            view.setInt16(i * 2, s < 0 ? s * 0x8000 : s * 0x7fff, true);
        }
        const u8 = new Uint8Array(buffer);
        let binary = "";
        const chunkSize = 0x8000;
        for(let i = 0; i < u8.length; i += chunkSize){
            binary += String.fromCharCode.apply(null, Array.from(u8.subarray(i, i + chunkSize)));
        }
        return btoa(binary);
    };
    const parseIatText = (msg)=>{
        try {
            const ws = msg?.data?.result?.ws || [];
            const parts = [];
            for (const w of ws){
                const cw = w?.cw || [];
                if (cw[0]?.w) parts.push(cw[0].w);
            }
            return parts.join("");
        } catch  {
            return "";
        }
    };
    const startIflytek = async ()=>{
        try {
            const signRes = await fetch("/api/voice/iflytek/sign");
            if (signRes.status === 501) {
                setState("error");
                setMessage("未配置讯飞密钥，请在 .env.local 配置 IFLYTEK_APP_ID/KEY/SECRET");
                return;
            }
            const { wsUrl, appId } = await signRes.json();
            const stream = await navigator.mediaDevices.getUserMedia({
                audio: true
            });
            streamRef.current = stream;
            // 使用默认设备采样率，避免部分浏览器不支持强制 16000 采样率
            const AC = window.AudioContext || window.webkitAudioContext;
            const audioCtx = new AC();
            audioCtxRef.current = audioCtx;
            const source = audioCtx.createMediaStreamSource(stream);
            const processor = audioCtx.createScriptProcessor(4096, 1, 1);
            processorRef.current = processor;
            const ws = new WebSocket(wsUrl);
            wsRef.current = ws;
            textRef.current = "";
            setState("recording");
            setMessage("录音中（讯飞）...");
            ws.onopen = ()=>{
                // 发送开始帧
                const startFrame = {
                    common: {
                        app_id: appId
                    },
                    business: {
                        language: "zh_cn",
                        domain: "iat",
                        accent: "mandarin",
                        // 启用动态修正以便实时返回片段
                        dwa: "wpgs",
                        vad_eos: 5000
                    },
                    data: {
                        status: 0,
                        format: "audio/L16;rate=16000",
                        encoding: "raw",
                        audio: ""
                    }
                };
                ws.send(JSON.stringify(startFrame));
                processor.onaudioprocess = (e)=>{
                    const input = e.inputBuffer.getChannelData(0);
                    const base64 = floatTo16kBase64(input, audioCtx.sampleRate, 16000);
                    const frame = {
                        data: {
                            status: 1,
                            format: "audio/L16;rate=16000",
                            encoding: "raw",
                            audio: base64
                        }
                    };
                    ws.send(JSON.stringify(frame));
                };
                source.connect(processor);
                processor.connect(audioCtx.destination);
                tokensRef.current = [];
            };
            ws.onmessage = async (ev)=>{
                try {
                    let data;
                    if (typeof ev.data === "string") {
                        data = JSON.parse(ev.data);
                    } else if (ev.data instanceof Blob) {
                        data = JSON.parse(await ev.data.text());
                    } else if (ev.data instanceof ArrayBuffer) {
                        data = JSON.parse(new TextDecoder().decode(ev.data));
                    } else {
                        data = ev.data;
                    }
                    if (data.code !== 0) {
                        setState("error");
                        setMessage(data.message || "讯飞识别错误");
                        return;
                    }
                    const status = data?.data?.status;
                    const result = data?.data?.result || {};
                    const wsArr = result.ws || [];
                    const pgs = result.pgs; // 'apd' 追加 或 'rpl' 替换
                    const rg = result.rg || []; // [start, end] 1-based
                    const words = [];
                    for (const w of wsArr){
                        const cw = w?.cw || [];
                        if (cw[0]?.w) words.push(cw[0].w);
                    }
                    if (words.length) {
                        if (pgs === "rpl" && Array.isArray(rg) && rg.length === 2) {
                            const start = Math.max(0, Number(rg[0]) - 1);
                            const end = Math.min(tokensRef.current.length, Number(rg[1]));
                            tokensRef.current.splice(start, end - start, ...words);
                        } else {
                            tokensRef.current.push(...words);
                        }
                        const full = tokensRef.current.join("");
                        setMessage(full);
                        textRef.current = full;
                        if (status === 2) {
                            setState("done");
                            onTranscribe?.(full);
                            try {
                                ws.close();
                            } catch  {}
                        }
                    }
                } catch (e) {
                    setState("error");
                    setMessage(e?.message || "讯飞消息解析失败");
                }
            };
            ws.onerror = ()=>{
                // 连接失败时提示并保持错误状态，不回退，以确保使用讯飞方案
                try {
                    source.disconnect();
                    processor.disconnect();
                    if (audioCtx.state !== "closed") audioCtx.close();
                    stream.getTracks().forEach((t)=>t.stop());
                } catch  {}
                setState("error");
                setMessage("讯飞连接错误，请检查密钥、系统时间或网络");
            };
            ws.onclose = (ev)=>{
                if (textRef.current) {
                    setState("done");
                    onTranscribe?.(textRef.current);
                } else if (state === "recording") {
                    // 若正在录音被关闭，则恢复为空闲
                    setState("idle");
                    setMessage("已停止");
                }
                // 清理资源
                try {
                    source.disconnect();
                    processor.disconnect();
                    if (audioCtx.state !== "closed") audioCtx.close();
                    stream.getTracks().forEach((t)=>t.stop());
                } catch  {}
            };
        } catch (e) {
            setState("error");
            setMessage(e?.message || "讯飞启动失败");
        }
    };
    // 浏览器语音识别回退
    const startBrowserSpeech = ()=>{
        const SR = window.webkitSpeechRecognition || window.SpeechRecognition;
        if (!SR) {
            setState("error");
            setMessage("浏览器不支持 Web Speech API");
            return;
        }
        const recog = new SR();
        recog.lang = "zh-CN";
        recog.continuous = false;
        recog.interimResults = false;
        setState("recording");
        recog.onresult = (ev)=>{
            const text = ev.results?.[0]?.[0]?.transcript || "";
            setState("done");
            setMessage(text);
            onTranscribe?.(text);
        };
        recog.onerror = (e)=>{
            setState("error");
            setMessage(e?.message || "识别失败");
        };
        recog.onend = ()=>{
            if (state === "recording") setState("idle");
        };
        recog.start();
    };
    const startRecording = async ()=>{
        await startIflytek();
    };
    const stopRecording = ()=>{
        // 发送结束帧（若连接已打开）
        try {
            if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {
                wsRef.current.send(JSON.stringify({
                    data: {
                        status: 2,
                        format: "audio/L16;rate=16000",
                        encoding: "raw",
                        audio: ""
                    }
                }));
            }
        } catch  {}
        // 停止音频处理与关闭连接
        try {
            if (processorRef.current) {
                processorRef.current.onaudioprocess = null;
                processorRef.current.disconnect();
            }
        } catch  {}
        try {
            if (audioCtxRef.current && audioCtxRef.current.state !== "closed") {
                audioCtxRef.current.close();
            }
        } catch  {}
        // 允许服务端返回最终结果，再延迟关闭 WebSocket
        try {
            if (wsRef.current) {
                const ws = wsRef.current;
                setTimeout(()=>{
                    try {
                        if (ws.readyState === WebSocket.OPEN) ws.close();
                    } catch  {}
                }, 800);
            }
        } catch  {}
        processorRef.current = null;
        audioCtxRef.current = null;
        wsRef.current = null;
        // 停止麦克风流
        try {
            streamRef.current?.getTracks().forEach((t)=>t.stop());
        } catch  {}
        streamRef.current = null;
        // 切为“转写中”，提示稍后生成路线
        setState("transcribing");
        setMessage("已停止，处理中...");
    };
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "VoiceButton.useEffect": ()=>({
                "VoiceButton.useEffect": ()=>stopRecording()
            })["VoiceButton.useEffect"]
    }["VoiceButton.useEffect"], []);
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: [
            "flex items-center gap-2",
            className
        ].join(" "),
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                className: "rounded bg-black px-3 py-1.5 text-white disabled:opacity-60",
                onClick: state === "recording" ? stopRecording : startRecording,
                children: state === "recording" ? "停止" : "语音输入"
            }, void 0, false, {
                fileName: "[project]/AI-Travel/web/src/components/VoiceButton.tsx",
                lineNumber: 290,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                className: "text-xs text-zinc-500",
                children: message
            }, void 0, false, {
                fileName: "[project]/AI-Travel/web/src/components/VoiceButton.tsx",
                lineNumber: 297,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/AI-Travel/web/src/components/VoiceButton.tsx",
        lineNumber: 289,
        columnNumber: 5
    }, this);
}
_s(VoiceButton, "aw4rljnNAl8En9XyyMMT/IhUYWU=");
_c = VoiceButton;
var _c;
__turbopack_context__.k.register(_c, "VoiceButton");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/AI-Travel/web/src/app/page.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>HomePage
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI-Travel/web/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI-Travel/web/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$src$2f$components$2f$Input$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI-Travel/web/src/components/Input.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$src$2f$components$2f$VoiceButton$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI-Travel/web/src/components/VoiceButton.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI-Travel/web/node_modules/next/navigation.js [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
function parseSpecFromText(text) {
    const t = text.trim();
    const cities = [
        "北京",
        "天津",
        "上海",
        "重庆",
        "广州",
        "深圳",
        "杭州",
        "苏州",
        "南京",
        "武汉",
        "成都",
        "西安",
        "青岛",
        "大连",
        "沈阳",
        "长春",
        "哈尔滨",
        "济南",
        "郑州",
        "佛山",
        "宁波",
        "无锡",
        "厦门",
        "福州",
        "合肥",
        "长沙",
        "南昌",
        "昆明",
        "石家庄",
        "太原",
        "兰州",
        "呼和浩特",
        "南宁",
        "贵阳",
        "海口",
        "三亚",
        "西宁",
        "银川",
        "乌鲁木齐"
    ];
    let destination = "北京";
    for (const c of cities){
        if (t.includes(c)) {
            destination = c;
            break;
        }
    }
    const mCity = t.match(/([\u4e00-\u9fa5]+)市/);
    if (mCity) destination = mCity[1];
    const mDates = Array.from(t.matchAll(/(20\d{2}-\d{2}-\d{2})/g)).map((m)=>m[1]);
    const today = new Date();
    const fmt = (d)=>d.toISOString().slice(0, 10);
    let start = fmt(today);
    let end = fmt(new Date(today.getTime() + 2 * 86400000));
    if (mDates.length >= 2) {
        start = mDates[0];
        end = mDates[1];
    } else if (mDates.length === 1) {
        start = mDates[0];
        const d1 = new Date(mDates[0]);
        end = fmt(new Date(d1.getTime() + 2 * 86400000));
    }
    let pace = "standard";
    if (/悠闲|轻松|休闲|慢/.test(t)) pace = "relaxed";
    if (/紧凑|高强度|赶场|多安排/.test(t)) pace = "intense";
    // 预算提取（“预算5000元”、“预算：8000”、“¥6000”等）
    let budgetTotal = undefined;
    const mb = t.match(/预算[:：\s]*([\d,.]+)/) || t.match(/¥\s*([\d,.]+)/) || t.match(/([\d,.]+)\s*元/);
    if (mb) {
        const num = Number(String(mb[1]).replace(/[,]/g, ""));
        if (Number.isFinite(num) && num > 0) budgetTotal = num;
    }
    return {
        destination,
        start_date: start,
        end_date: end,
        preferences: {
            pace,
            ...budgetTotal ? {
                budgetTotal
            } : {}
        }
    };
}
function HomePage() {
    _s();
    const [text, setText] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("");
    const [loading, setLoading] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [error, setError] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const router = (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRouter"])();
    const handleStart = async ()=>{
        const spec = parseSpecFromText(text);
        setLoading(true);
        setError(null);
        try {
            const res = await fetch("/api/plan/create", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(spec)
            });
            if (!res.ok) {
                const msg = await res.text().catch(()=>"生成失败");
                throw new Error(msg || "生成失败");
            }
            const data = await res.json();
            try {
                localStorage.setItem("lastPlan", JSON.stringify(data));
            } catch  {}
            router.push("/plan");
        } catch (e) {
            setError(e?.message || "生成失败");
        } finally{
            setLoading(false);
        }
    };
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "mx-auto max-w-3xl px-4 py-16",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h1", {
                className: "text-2xl font-semibold",
                children: "AI 旅行助手"
            }, void 0, false, {
                fileName: "[project]/AI-Travel/web/src/app/page.tsx",
                lineNumber: 82,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                className: "mt-3 text-zinc-600",
                children: "一个输入框，支持语音识别；点击开始规划。"
            }, void 0, false, {
                fileName: "[project]/AI-Travel/web/src/app/page.tsx",
                lineNumber: 83,
                columnNumber: 7
            }, this),
            error && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "mt-4 rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700",
                children: error
            }, void 0, false, {
                fileName: "[project]/AI-Travel/web/src/app/page.tsx",
                lineNumber: 86,
                columnNumber: 9
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "mt-6 relative",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$src$2f$components$2f$Input$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                        placeholder: "例如：下周在杭州安排一个轻松的三天行程",
                        value: text,
                        onChange: (e)=>setText(e.target.value),
                        className: "pr-12"
                    }, void 0, false, {
                        fileName: "[project]/AI-Travel/web/src/app/page.tsx",
                        lineNumber: 91,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "absolute right-2 top-1/2 -translate-y-1/2",
                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$src$2f$components$2f$VoiceButton$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                            onTranscribe: (t)=>setText(t)
                        }, void 0, false, {
                            fileName: "[project]/AI-Travel/web/src/app/page.tsx",
                            lineNumber: 98,
                            columnNumber: 11
                        }, this)
                    }, void 0, false, {
                        fileName: "[project]/AI-Travel/web/src/app/page.tsx",
                        lineNumber: 97,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/AI-Travel/web/src/app/page.tsx",
                lineNumber: 90,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "mt-4",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                    className: "rounded-md bg-blue-600 px-4 py-2 text-white disabled:opacity-60",
                    onClick: handleStart,
                    disabled: loading || !text.trim(),
                    children: loading ? "生成中..." : "开始规划"
                }, void 0, false, {
                    fileName: "[project]/AI-Travel/web/src/app/page.tsx",
                    lineNumber: 103,
                    columnNumber: 9
                }, this)
            }, void 0, false, {
                fileName: "[project]/AI-Travel/web/src/app/page.tsx",
                lineNumber: 102,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/AI-Travel/web/src/app/page.tsx",
        lineNumber: 81,
        columnNumber: 5
    }, this);
}
_s(HomePage, "aouFBSKSc3AjaaMEaQIPbzs4Tp4=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$AI$2d$Travel$2f$web$2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRouter"]
    ];
});
_c = HomePage;
var _c;
__turbopack_context__.k.register(_c, "HomePage");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/AI-Travel/web/node_modules/next/navigation.js [app-client] (ecmascript)", ((__turbopack_context__, module, exports) => {

module.exports = __turbopack_context__.r("[project]/AI-Travel/web/node_modules/next/dist/client/components/navigation.js [app-client] (ecmascript)");
}),
]);

//# sourceMappingURL=AI-Travel_web_9d076521._.js.map